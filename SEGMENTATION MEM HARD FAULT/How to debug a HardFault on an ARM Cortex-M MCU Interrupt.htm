<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <!-- Meta -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="referrer" content="no-referrer-when-downgrade">
  <meta name="title" content="How to debug a HardFault on an ARM Cortex-M MCU">
  <meta property="og:title" content="How to debug a HardFault on an ARM Cortex-M MCU">
  <meta property="og:description" content="A community and blog for embedded software makers">

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>How to debug a HardFault on an ARM Cortex-M MCU | Interrupt</title>
<meta name="generator" content="Jekyll v3.8.5">
<meta property="og:title" content="How to debug a HardFault on an ARM Cortex-M MCU">
<meta name="author" content="Chris Coleman">
<meta property="og:locale" content="en_US">
<meta name="description" content="A step by step guide of how to investigate what led to a fault on a Cortex-M device with examples and strategies about how to recover">
<meta property="og:description" content="A step by step guide of how to investigate what led to a fault on a Cortex-M device with examples and strategies about how to recover">
<link rel="canonical" href="https://interrupt.memfault.com/blog/cortex-m-fault-debug">
<meta property="og:url" content="https://interrupt.memfault.com/blog/cortex-m-fault-debug">
<meta property="og:site_name" content="Interrupt">
<meta property="og:image" content="https://interrupt.memfault.com/blog/img/cortex-m-fault/cortex-m-fault-gdb-debug2.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-11-20T00:00:00+00:00">
<meta name="google-site-verification" content="2qyLRd8BiI5o3XnqssLvbzPDJ-2S6ytb9iLoNoz1Z9M">
<script type="text/javascript" async="" src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/conversion_async.js"></script><script type="text/javascript" async="" src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/insight.js"></script><script type="text/javascript" async="" src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/js_002"></script><script src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/collectedforms.js" type="text/javascript" id="CollectedForms-8551838" crossorigin="anonymous" data-leadin-portal-id="8551838" data-leadin-env="prod" data-loader="hs-scriptloader" data-hsjs-portal="8551838" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/8551838.js" type="text/javascript" id="cookieBanner-8551838" data-cookieconsent="ignore" data-loader="hs-scriptloader" data-hsjs-portal="8551838" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/conversations-embed.js" type="text/javascript" id="hubspot-messages-loader" data-loader="hs-scriptloader" data-hsjs-portal="8551838" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/8551838_003.js" type="text/javascript" id="hs-analytics"></script><script src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/fb.js" type="text/javascript" id="hs-ads-pixel-8551838" data-ads-portal-id="8551838" data-ads-env="prod" data-loader="hs-scriptloader" data-hsjs-portal="8551838" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script type="text/javascript" async="" src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/analytics.js"></script><script type="application/ld+json">
{"datePublished":"2019-11-20T00:00:00+00:00","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://interrupt.memfault.com/blog/img/interrupt-logo-1200px.png"},"name":"Chris Coleman"},"image":"https://interrupt.memfault.com/blog/img/cortex-m-fault/cortex-m-fault-gdb-debug2.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://interrupt.memfault.com/blog/cortex-m-fault-debug"},"author":{"@type":"Person","name":"Chris Coleman"},"description":"A step by step guide of how to investigate what led to a fault on a Cortex-M device with examples and strategies about how to recover","@type":"BlogPosting","url":"https://interrupt.memfault.com/blog/cortex-m-fault-debug","headline":"How to debug a HardFault on an ARM Cortex-M MCU","dateModified":"2019-11-20T00:00:00+00:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="" src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/js_003"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-133918181-3');
  </script>

  <title>How to debug a HardFault on an ARM Cortex-M MCU</title>
  <link rel="icon" href="https://interrupt.memfault.com/blog/img/favicon.png" type="image/png">

  <!-- CSS & fonts -->
  <style class="anchorjs"></style><link rel="stylesheet" href="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/main.css">
  <link href="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/css.css" rel="stylesheet" type="text/css">
  <link href="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/font-awesome.css" rel="stylesheet">
  <!-- RSS -->
  <link href="https://interrupt.memfault.com/blog/feed.xml" type="application/rss+xml" rel="alternate" title="RSS 2.0 Feed">

<script type="text/javascript" async="" src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/embed.js"></script><style type="text/css" id="hs-form-stylea61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68">.fn-date-picker.pika-single{z-index:9999;display:block;position:relative;color:#333;background:#fff;border:1px solid #ccc;border-bottom-color:#bbb;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;*zoom:1}.fn-date-picker.pika-single.is-hidden{display:none}.fn-date-picker.pika-single.is-bound{position:absolute;box-shadow:0 5px 15px -5px rgba(0,0,0,.5)}.fn-date-picker.pika-single:after,.fn-date-picker.pika-single:before{content:" ";display:table}.fn-date-picker.pika-single:after{clear:both}.fn-date-picker .pika-lendar{float:left;width:240px;margin:8px}.fn-date-picker .pika-title{position:relative;text-align:center}.fn-date-picker .pika-title select{cursor:pointer;position:absolute;z-index:9998;margin:0;left:0;top:5px;filter:alpha(opacity=0);opacity:0}.fn-date-picker .pika-label{display:inline-block;*display:inline;position:relative;z-index:9999;overflow:hidden;margin:0;padding:5px 3px;font-size:14px;line-height:20px;font-weight:700;background-color:#fff}.fn-date-picker .pika-next,.fn-date-picker .pika-prev{display:block;cursor:pointer;position:relative;outline:none;border:0;padding:0;width:20px;height:30px;text-indent:20px;white-space:nowrap;overflow:hidden;background-color:transparent;background-position:50%;background-repeat:no-repeat;background-size:75% 75%;opacity:.5;*position:absolute;*top:0}.fn-date-picker .pika-next:hover,.fn-date-picker .pika-prev:hover{opacity:1}.fn-date-picker .pika-next.is-disabled,.fn-date-picker .pika-prev.is-disabled{cursor:default;opacity:.2}.fn-date-picker .is-rtl .pika-next,.fn-date-picker .pika-prev{float:left;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAAUklEQVR42u3VMQoAIBADQf8Pgj+OD9hG2CtONJB2ymQkKe0HbwAP0xucDiQWARITIDEBEnMgMQ8S8+AqBIl6kKgHiXqQqAeJepBo/z38J/U0uAHlaBkBl9I4GwAAAABJRU5ErkJggg==);*left:0}.fn-date-picker .is-rtl .pika-prev,.fn-date-picker .pika-next{float:right;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAAU0lEQVR42u3VOwoAMAgE0dwfAnNjU26bYkBCFGwfiL9VVWoO+BJ4Gf3gtsEKKoFBNTCoCAYVwaAiGNQGMUHMkjGbgjk2mIONuXo0nC8XnCf1JXgArVIZAQh5TKYAAAAASUVORK5CYII=);*right:0}.fn-date-picker .pika-select{display:inline-block;*display:inline}.fn-date-picker .pika-table{width:100%;border-collapse:collapse;border-spacing:0;border:0}.fn-date-picker .pika-table td,.fn-date-picker .pika-table th{width:14.285714285714286%;padding:0}.fn-date-picker .pika-table th{color:#999;font-size:12px;line-height:25px;font-weight:700;text-align:center}.fn-date-picker .pika-table abbr{border-bottom:none;cursor:help}.fn-date-picker .pika-button{cursor:pointer;display:block;-moz-box-sizing:border-box;box-sizing:border-box;outline:none;border:0;margin:0;width:100%;padding:5px;color:#666;font-size:12px;line-height:15px;text-align:right;background:#f5f5f5}.fn-date-picker .pika-button:hover{color:#fff!important;background:#ff8000!important;box-shadow:none!important;border-radius:3px!important}.fn-date-picker .is-today .pika-button{color:#3af;font-weight:700}.fn-date-picker .is-selected .pika-button{color:#fff;font-weight:700;background:#3af;box-shadow:inset 0 1px 3px #178fe5;border-radius:3px}.fn-date-picker .is-disabled .pika-button{pointer-events:none;cursor:default;color:#999;opacity:.3}.fn-date-picker .pika-week{font-size:11px;color:#999}

.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 .inputs-list.inline-list li{vertical-align:top;display:inline-block;word-wrap:break-word;padding-right:16px}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 .inputs-list.inline-list li:after{clear:both}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 .inputs-list.inline-list li input{float:left}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 .inputs-list.inline-list.inline-list-2 li{width:50%}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 .inputs-list.inline-list.inline-list-2 li:nth-child(2n){padding-right:0}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 .inputs-list.inline-list.inline-list-3 li{width:33%}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 .inputs-list.inline-list.inline-list-3 li:nth-child(3n){width:34%;padding-right:0}.hs-fieldtype-intl-phone.hs-input{padding:0;background:none;border:none;height:auto}.hs-fieldtype-intl-phone.hs-input:after{clear:both;content:" ";display:table}.hs-fieldtype-intl-phone.hs-input .hs-input{margin-bottom:0}.hs-fieldtype-intl-phone.hs-input input{width:68%!important;float:right}.hs-fieldtype-intl-phone.hs-input select{float:left;width:30%!important}@media (max-device-width:480px) and (min-device-width:320px),(max-width:400px){.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68>.hs-phone>.input>.hs-fieldtype-intl-phone.hs-input>input.hs-input{width:68%!important}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68>.hs-phone>.input>.hs-fieldtype-intl-phone.hs-input>select.hs-input{width:30%!important}}.hs-input-range-container{width:95%}.hs-input-range-container div{display:inline-block;line-height:50px}.hs-input-range-container .hs-input-range{width:90%;height:40px}.hs-input-range-container .hs-input-range>*{vertical-align:middle}.hs-input-range-container .hs-input-range input{margin:0 5px;width:85%}.hs-input-range-container .hs-input-range-value-container{width:10%}.hs-input-range-container .hs-input{width:100%!important;margin-right:1px;background-color:#fff;text-align:center}.hs-input-range__slider{appearance:none;margin:0;height:30px;overflow:hidden;cursor:pointer}.hs-input-range__slider:focus{outline:none}.hs-input-range__slider::-webkit-slider-runnable-track{width:100%;height:30px;background:linear-gradient(180deg,#0199ff,#0199ff) 100% 50%/100% 3px no-repeat transparent}.hs-input-range__slider::-webkit-slider-thumb{position:relative;appearance:none;height:13px;width:13px;background:#0199ff;border-radius:100%;border:0;top:50%;margin-top:-7.5px;box-shadow:1px 0 0 -5px #cfcfcf,2px 0 0 -5px #cfcfcf,3px 0 0 -5px #cfcfcf,4px 0 0 -5px #cfcfcf,5px 0 0 -5px #cfcfcf,6px 0 0 -5px #cfcfcf,7px 0 0 -5px #cfcfcf,8px 0 0 -5px #cfcfcf,9px 0 0 -5px #cfcfcf,10px 0 0 -5px #cfcfcf,11px 0 0 -5px #cfcfcf,12px 0 0 -5px #cfcfcf,13px 0 0 -5px #cfcfcf,14px 0 0 -5px #cfcfcf,15px 0 0 -5px #cfcfcf,16px 0 0 -5px #cfcfcf,17px 0 0 -5px #cfcfcf,18px 0 0 -5px #cfcfcf,19px 0 0 -5px #cfcfcf,20px 0 0 -5px #cfcfcf,21px 0 0 -5px #cfcfcf,22px 0 0 -5px #cfcfcf,23px 0 0 -5px #cfcfcf,24px 0 0 -5px #cfcfcf,25px 0 0 -5px #cfcfcf,26px 0 0 -5px #cfcfcf,27px 0 0 -5px #cfcfcf,28px 0 0 -5px #cfcfcf,29px 0 0 -5px #cfcfcf,30px 0 0 -5px #cfcfcf,31px 0 0 -5px #cfcfcf,32px 0 0 -5px #cfcfcf,33px 0 0 -5px #cfcfcf,34px 0 0 -5px #cfcfcf,35px 0 0 -5px #cfcfcf,36px 0 0 -5px #cfcfcf,37px 0 0 -5px #cfcfcf,38px 0 0 -5px #cfcfcf,39px 0 0 -5px #cfcfcf,40px 0 0 -5px #cfcfcf,41px 0 0 -5px #cfcfcf,42px 0 0 -5px #cfcfcf,43px 0 0 -5px #cfcfcf,44px 0 0 -5px #cfcfcf,45px 0 0 -5px #cfcfcf,46px 0 0 -5px #cfcfcf,47px 0 0 -5px #cfcfcf,48px 0 0 -5px #cfcfcf,49px 0 0 -5px #cfcfcf,50px 0 0 -5px #cfcfcf,51px 0 0 -5px #cfcfcf,52px 0 0 -5px #cfcfcf,53px 0 0 -5px #cfcfcf,54px 0 0 -5px #cfcfcf,55px 0 0 -5px #cfcfcf,56px 0 0 -5px #cfcfcf,57px 0 0 -5px #cfcfcf,58px 0 0 -5px #cfcfcf,59px 0 0 -5px #cfcfcf,60px 0 0 -5px #cfcfcf,61px 0 0 -5px #cfcfcf,62px 0 0 -5px #cfcfcf,63px 0 0 -5px #cfcfcf,64px 0 0 -5px #cfcfcf,65px 0 0 -5px #cfcfcf,66px 0 0 -5px #cfcfcf,67px 0 0 -5px #cfcfcf,68px 0 0 -5px #cfcfcf,69px 0 0 -5px #cfcfcf,70px 0 0 -5px #cfcfcf,71px 0 0 -5px #cfcfcf,72px 0 0 -5px #cfcfcf,73px 0 0 -5px #cfcfcf,74px 0 0 -5px #cfcfcf,75px 0 0 -5px #cfcfcf,76px 0 0 -5px #cfcfcf,77px 0 0 -5px #cfcfcf,78px 0 0 -5px #cfcfcf,79px 0 0 -5px #cfcfcf,80px 0 0 -5px #cfcfcf,81px 0 0 -5px #cfcfcf,82px 0 0 -5px #cfcfcf,83px 0 0 -5px #cfcfcf,84px 0 0 -5px #cfcfcf,85px 0 0 -5px #cfcfcf,86px 0 0 -5px #cfcfcf,87px 0 0 -5px #cfcfcf,88px 0 0 -5px #cfcfcf,89px 0 0 -5px #cfcfcf,90px 0 0 -5px #cfcfcf,91px 0 0 -5px #cfcfcf,92px 0 0 -5px #cfcfcf,93px 0 0 -5px #cfcfcf,94px 0 0 -5px #cfcfcf,95px 0 0 -5px #cfcfcf,96px 0 0 -5px #cfcfcf,97px 0 0 -5px #cfcfcf,98px 0 0 -5px #cfcfcf,99px 0 0 -5px #cfcfcf,100px 0 0 -5px #cfcfcf,101px 0 0 -5px #cfcfcf,102px 0 0 -5px #cfcfcf,103px 0 0 -5px #cfcfcf,104px 0 0 -5px #cfcfcf,105px 0 0 -5px #cfcfcf,106px 0 0 -5px #cfcfcf,107px 0 0 -5px #cfcfcf,108px 0 0 -5px #cfcfcf,109px 0 0 -5px #cfcfcf,110px 0 0 -5px #cfcfcf,111px 0 0 -5px #cfcfcf,112px 0 0 -5px #cfcfcf,113px 0 0 -5px #cfcfcf,114px 0 0 -5px #cfcfcf,115px 0 0 -5px #cfcfcf,116px 0 0 -5px #cfcfcf,117px 0 0 -5px #cfcfcf,118px 0 0 -5px #cfcfcf,119px 0 0 -5px #cfcfcf,120px 0 0 -5px #cfcfcf,121px 0 0 -5px #cfcfcf,122px 0 0 -5px #cfcfcf,123px 0 0 -5px #cfcfcf,124px 0 0 -5px #cfcfcf,125px 0 0 -5px #cfcfcf,126px 0 0 -5px #cfcfcf,127px 0 0 -5px #cfcfcf,128px 0 0 -5px #cfcfcf,129px 0 0 -5px #cfcfcf,130px 0 0 -5px #cfcfcf,131px 0 0 -5px #cfcfcf,132px 0 0 -5px #cfcfcf,133px 0 0 -5px #cfcfcf,134px 0 0 -5px #cfcfcf,135px 0 0 -5px #cfcfcf,136px 0 0 -5px #cfcfcf,137px 0 0 -5px #cfcfcf,138px 0 0 -5px #cfcfcf,139px 0 0 -5px #cfcfcf,140px 0 0 -5px #cfcfcf,141px 0 0 -5px #cfcfcf,142px 0 0 -5px #cfcfcf,143px 0 0 -5px #cfcfcf,144px 0 0 -5px #cfcfcf,145px 0 0 -5px #cfcfcf,146px 0 0 -5px #cfcfcf,147px 0 0 -5px #cfcfcf,148px 0 0 -5px #cfcfcf,149px 0 0 -5px #cfcfcf,150px 0 0 -5px #cfcfcf,151px 0 0 -5px #cfcfcf,152px 0 0 -5px #cfcfcf,153px 0 0 -5px #cfcfcf,154px 0 0 -5px #cfcfcf,155px 0 0 -5px #cfcfcf,156px 0 0 -5px #cfcfcf,157px 0 0 -5px #cfcfcf,158px 0 0 -5px #cfcfcf,159px 0 0 -5px #cfcfcf,160px 0 0 -5px #cfcfcf,161px 0 0 -5px #cfcfcf,162px 0 0 -5px #cfcfcf,163px 0 0 -5px #cfcfcf,164px 0 0 -5px #cfcfcf,165px 0 0 -5px #cfcfcf,166px 0 0 -5px #cfcfcf,167px 0 0 -5px #cfcfcf,168px 0 0 -5px #cfcfcf,169px 0 0 -5px #cfcfcf,170px 0 0 -5px #cfcfcf,171px 0 0 -5px #cfcfcf,172px 0 0 -5px #cfcfcf,173px 0 0 -5px #cfcfcf,174px 0 0 -5px #cfcfcf,175px 0 0 -5px #cfcfcf,176px 0 0 -5px #cfcfcf,177px 0 0 -5px #cfcfcf,178px 0 0 -5px #cfcfcf,179px 0 0 -5px #cfcfcf,180px 0 0 -5px #cfcfcf,181px 0 0 -5px #cfcfcf,182px 0 0 -5px #cfcfcf,183px 0 0 -5px #cfcfcf,184px 0 0 -5px #cfcfcf,185px 0 0 -5px #cfcfcf,186px 0 0 -5px #cfcfcf,187px 0 0 -5px #cfcfcf,188px 0 0 -5px #cfcfcf,189px 0 0 -5px #cfcfcf,190px 0 0 -5px #cfcfcf,191px 0 0 -5px #cfcfcf,192px 0 0 -5px #cfcfcf,193px 0 0 -5px #cfcfcf,194px 0 0 -5px #cfcfcf,195px 0 0 -5px #cfcfcf,196px 0 0 -5px #cfcfcf,197px 0 0 -5px #cfcfcf,198px 0 0 -5px #cfcfcf,199px 0 0 -5px #cfcfcf,200px 0 0 -5px #cfcfcf,201px 0 0 -5px #cfcfcf,202px 0 0 -5px #cfcfcf,203px 0 0 -5px #cfcfcf,204px 0 0 -5px #cfcfcf,205px 0 0 -5px #cfcfcf,206px 0 0 -5px #cfcfcf,207px 0 0 -5px #cfcfcf,208px 0 0 -5px #cfcfcf,209px 0 0 -5px #cfcfcf,210px 0 0 -5px #cfcfcf,211px 0 0 -5px #cfcfcf,212px 0 0 -5px #cfcfcf,213px 0 0 -5px #cfcfcf,214px 0 0 -5px #cfcfcf,215px 0 0 -5px #cfcfcf,216px 0 0 -5px #cfcfcf,217px 0 0 -5px #cfcfcf,218px 0 0 -5px #cfcfcf,219px 0 0 -5px #cfcfcf,220px 0 0 -5px #cfcfcf,221px 0 0 -5px #cfcfcf,222px 0 0 -5px #cfcfcf,223px 0 0 -5px #cfcfcf,224px 0 0 -5px #cfcfcf,225px 0 0 -5px #cfcfcf,226px 0 0 -5px #cfcfcf,227px 0 0 -5px #cfcfcf,228px 0 0 -5px #cfcfcf,229px 0 0 -5px #cfcfcf,230px 0 0 -5px #cfcfcf,231px 0 0 -5px #cfcfcf,232px 0 0 -5px #cfcfcf,233px 0 0 -5px #cfcfcf,234px 0 0 -5px #cfcfcf,235px 0 0 -5px #cfcfcf,236px 0 0 -5px #cfcfcf,237px 0 0 -5px #cfcfcf,238px 0 0 -5px #cfcfcf,239px 0 0 -5px #cfcfcf,240px 0 0 -5px #cfcfcf,241px 0 0 -5px #cfcfcf,242px 0 0 -5px #cfcfcf,243px 0 0 -5px #cfcfcf,244px 0 0 -5px #cfcfcf,245px 0 0 -5px #cfcfcf,246px 0 0 -5px #cfcfcf,247px 0 0 -5px #cfcfcf,248px 0 0 -5px #cfcfcf,249px 0 0 -5px #cfcfcf,250px 0 0 -5px #cfcfcf,251px 0 0 -5px #cfcfcf,252px 0 0 -5px #cfcfcf,253px 0 0 -5px #cfcfcf,254px 0 0 -5px #cfcfcf,255px 0 0 -5px #cfcfcf,256px 0 0 -5px #cfcfcf,257px 0 0 -5px #cfcfcf,258px 0 0 -5px #cfcfcf,259px 0 0 -5px #cfcfcf,260px 0 0 -5px #cfcfcf,261px 0 0 -5px #cfcfcf,262px 0 0 -5px #cfcfcf,263px 0 0 -5px #cfcfcf,264px 0 0 -5px #cfcfcf,265px 0 0 -5px #cfcfcf,266px 0 0 -5px #cfcfcf,267px 0 0 -5px #cfcfcf,268px 0 0 -5px #cfcfcf,269px 0 0 -5px #cfcfcf,270px 0 0 -5px #cfcfcf,271px 0 0 -5px #cfcfcf,272px 0 0 -5px #cfcfcf,273px 0 0 -5px #cfcfcf,274px 0 0 -5px #cfcfcf,275px 0 0 -5px #cfcfcf,276px 0 0 -5px #cfcfcf,277px 0 0 -5px #cfcfcf,278px 0 0 -5px #cfcfcf,279px 0 0 -5px #cfcfcf,280px 0 0 -5px #cfcfcf,281px 0 0 -5px #cfcfcf,282px 0 0 -5px #cfcfcf,283px 0 0 -5px #cfcfcf,284px 0 0 -5px #cfcfcf,285px 0 0 -5px #cfcfcf,286px 0 0 -5px #cfcfcf,287px 0 0 -5px #cfcfcf,288px 0 0 -5px #cfcfcf,289px 0 0 -5px #cfcfcf,290px 0 0 -5px #cfcfcf,291px 0 0 -5px #cfcfcf,292px 0 0 -5px #cfcfcf,293px 0 0 -5px #cfcfcf,294px 0 0 -5px #cfcfcf,295px 0 0 -5px #cfcfcf,296px 0 0 -5px #cfcfcf,297px 0 0 -5px #cfcfcf,298px 0 0 -5px #cfcfcf,299px 0 0 -5px #cfcfcf,300px 0 0 -5px #cfcfcf,301px 0 0 -5px #cfcfcf,302px 0 0 -5px #cfcfcf,303px 0 0 -5px #cfcfcf,304px 0 0 -5px #cfcfcf,305px 0 0 -5px #cfcfcf,306px 0 0 -5px #cfcfcf,307px 0 0 -5px #cfcfcf,308px 0 0 -5px #cfcfcf,309px 0 0 -5px #cfcfcf,310px 0 0 -5px #cfcfcf,311px 0 0 -5px #cfcfcf,312px 0 0 -5px #cfcfcf,313px 0 0 -5px #cfcfcf,314px 0 0 -5px #cfcfcf,315px 0 0 -5px #cfcfcf,316px 0 0 -5px #cfcfcf,317px 0 0 -5px #cfcfcf,318px 0 0 -5px #cfcfcf,319px 0 0 -5px #cfcfcf,320px 0 0 -5px #cfcfcf,321px 0 0 -5px #cfcfcf,322px 0 0 -5px #cfcfcf,323px 0 0 -5px #cfcfcf,324px 0 0 -5px #cfcfcf,325px 0 0 -5px #cfcfcf,326px 0 0 -5px #cfcfcf,327px 0 0 -5px #cfcfcf,328px 0 0 -5px #cfcfcf,329px 0 0 -5px #cfcfcf,330px 0 0 -5px #cfcfcf,331px 0 0 -5px #cfcfcf,332px 0 0 -5px #cfcfcf,333px 0 0 -5px #cfcfcf,334px 0 0 -5px #cfcfcf,335px 0 0 -5px #cfcfcf,336px 0 0 -5px #cfcfcf,337px 0 0 -5px #cfcfcf,338px 0 0 -5px #cfcfcf,339px 0 0 -5px #cfcfcf,340px 0 0 -5px #cfcfcf,341px 0 0 -5px #cfcfcf,342px 0 0 -5px #cfcfcf,343px 0 0 -5px #cfcfcf,344px 0 0 -5px #cfcfcf,345px 0 0 -5px #cfcfcf,346px 0 0 -5px #cfcfcf,347px 0 0 -5px #cfcfcf,348px 0 0 -5px #cfcfcf,349px 0 0 -5px #cfcfcf,350px 0 0 -5px #cfcfcf,351px 0 0 -5px #cfcfcf,352px 0 0 -5px #cfcfcf,353px 0 0 -5px #cfcfcf,354px 0 0 -5px #cfcfcf,355px 0 0 -5px #cfcfcf,356px 0 0 -5px #cfcfcf,357px 0 0 -5px #cfcfcf,358px 0 0 -5px #cfcfcf,359px 0 0 -5px #cfcfcf,360px 0 0 -5px #cfcfcf,361px 0 0 -5px #cfcfcf,362px 0 0 -5px #cfcfcf,363px 0 0 -5px #cfcfcf,364px 0 0 -5px #cfcfcf,365px 0 0 -5px #cfcfcf,366px 0 0 -5px #cfcfcf,367px 0 0 -5px #cfcfcf,368px 0 0 -5px #cfcfcf,369px 0 0 -5px #cfcfcf,370px 0 0 -5px #cfcfcf,371px 0 0 -5px #cfcfcf,372px 0 0 -5px #cfcfcf,373px 0 0 -5px #cfcfcf,374px 0 0 -5px #cfcfcf,375px 0 0 -5px #cfcfcf,376px 0 0 -5px #cfcfcf,377px 0 0 -5px #cfcfcf,378px 0 0 -5px #cfcfcf,379px 0 0 -5px #cfcfcf,380px 0 0 -5px #cfcfcf,381px 0 0 -5px #cfcfcf,382px 0 0 -5px #cfcfcf,383px 0 0 -5px #cfcfcf,384px 0 0 -5px #cfcfcf,385px 0 0 -5px #cfcfcf,386px 0 0 -5px #cfcfcf,387px 0 0 -5px #cfcfcf,388px 0 0 -5px #cfcfcf,389px 0 0 -5px #cfcfcf,390px 0 0 -5px #cfcfcf,391px 0 0 -5px #cfcfcf,392px 0 0 -5px #cfcfcf,393px 0 0 -5px #cfcfcf,394px 0 0 -5px #cfcfcf,395px 0 0 -5px #cfcfcf,396px 0 0 -5px #cfcfcf,397px 0 0 -5px #cfcfcf,398px 0 0 -5px #cfcfcf,399px 0 0 -5px #cfcfcf,400px 0 0 -5px #cfcfcf,401px 0 0 -5px #cfcfcf,402px 0 0 -5px #cfcfcf,403px 0 0 -5px #cfcfcf,404px 0 0 -5px #cfcfcf,405px 0 0 -5px #cfcfcf,406px 0 0 -5px #cfcfcf,407px 0 0 -5px #cfcfcf,408px 0 0 -5px #cfcfcf,409px 0 0 -5px #cfcfcf,410px 0 0 -5px #cfcfcf,411px 0 0 -5px #cfcfcf,412px 0 0 -5px #cfcfcf,413px 0 0 -5px #cfcfcf,414px 0 0 -5px #cfcfcf,415px 0 0 -5px #cfcfcf,416px 0 0 -5px #cfcfcf,417px 0 0 -5px #cfcfcf,418px 0 0 -5px #cfcfcf,419px 0 0 -5px #cfcfcf,420px 0 0 -5px #cfcfcf,421px 0 0 -5px #cfcfcf,422px 0 0 -5px #cfcfcf,423px 0 0 -5px #cfcfcf,424px 0 0 -5px #cfcfcf,425px 0 0 -5px #cfcfcf,426px 0 0 -5px #cfcfcf,427px 0 0 -5px #cfcfcf,428px 0 0 -5px #cfcfcf,429px 0 0 -5px #cfcfcf,430px 0 0 -5px #cfcfcf,431px 0 0 -5px #cfcfcf,432px 0 0 -5px #cfcfcf,433px 0 0 -5px #cfcfcf,434px 0 0 -5px #cfcfcf,435px 0 0 -5px #cfcfcf,436px 0 0 -5px #cfcfcf,437px 0 0 -5px #cfcfcf,438px 0 0 -5px #cfcfcf,439px 0 0 -5px #cfcfcf,440px 0 0 -5px #cfcfcf,441px 0 0 -5px #cfcfcf,442px 0 0 -5px #cfcfcf,443px 0 0 -5px #cfcfcf,444px 0 0 -5px #cfcfcf,445px 0 0 -5px #cfcfcf,446px 0 0 -5px #cfcfcf,447px 0 0 -5px #cfcfcf,448px 0 0 -5px #cfcfcf,449px 0 0 -5px #cfcfcf,450px 0 0 -5px #cfcfcf,451px 0 0 -5px #cfcfcf,452px 0 0 -5px #cfcfcf,453px 0 0 -5px #cfcfcf,454px 0 0 -5px #cfcfcf,455px 0 0 -5px #cfcfcf,456px 0 0 -5px #cfcfcf,457px 0 0 -5px #cfcfcf,458px 0 0 -5px #cfcfcf,459px 0 0 -5px #cfcfcf,460px 0 0 -5px #cfcfcf,461px 0 0 -5px #cfcfcf,462px 0 0 -5px #cfcfcf,463px 0 0 -5px #cfcfcf,464px 0 0 -5px #cfcfcf,465px 0 0 -5px #cfcfcf,466px 0 0 -5px #cfcfcf,467px 0 0 -5px #cfcfcf,468px 0 0 -5px #cfcfcf,469px 0 0 -5px #cfcfcf,470px 0 0 -5px #cfcfcf,471px 0 0 -5px #cfcfcf,472px 0 0 -5px #cfcfcf,473px 0 0 -5px #cfcfcf,474px 0 0 -5px #cfcfcf,475px 0 0 -5px #cfcfcf,476px 0 0 -5px #cfcfcf,477px 0 0 -5px #cfcfcf,478px 0 0 -5px #cfcfcf,479px 0 0 -5px #cfcfcf,480px 0 0 -5px #cfcfcf,481px 0 0 -5px #cfcfcf,482px 0 0 -5px #cfcfcf,483px 0 0 -5px #cfcfcf,484px 0 0 -5px #cfcfcf,485px 0 0 -5px #cfcfcf,486px 0 0 -5px #cfcfcf,487px 0 0 -5px #cfcfcf,488px 0 0 -5px #cfcfcf,489px 0 0 -5px #cfcfcf,490px 0 0 -5px #cfcfcf,491px 0 0 -5px #cfcfcf,492px 0 0 -5px #cfcfcf,493px 0 0 -5px #cfcfcf,494px 0 0 -5px #cfcfcf,495px 0 0 -5px #cfcfcf,496px 0 0 -5px #cfcfcf,497px 0 0 -5px #cfcfcf,498px 0 0 -5px #cfcfcf,499px 0 0 -5px #cfcfcf,500px 0 0 -5px #cfcfcf,501px 0 0 -5px #cfcfcf,502px 0 0 -5px #cfcfcf,503px 0 0 -5px #cfcfcf,504px 0 0 -5px #cfcfcf,505px 0 0 -5px #cfcfcf,506px 0 0 -5px #cfcfcf,507px 0 0 -5px #cfcfcf,508px 0 0 -5px #cfcfcf,509px 0 0 -5px #cfcfcf,510px 0 0 -5px #cfcfcf,511px 0 0 -5px #cfcfcf,512px 0 0 -5px #cfcfcf,513px 0 0 -5px #cfcfcf,514px 0 0 -5px #cfcfcf,515px 0 0 -5px #cfcfcf,516px 0 0 -5px #cfcfcf,517px 0 0 -5px #cfcfcf,518px 0 0 -5px #cfcfcf,519px 0 0 -5px #cfcfcf,520px 0 0 -5px #cfcfcf,521px 0 0 -5px #cfcfcf,522px 0 0 -5px #cfcfcf,523px 0 0 -5px #cfcfcf,524px 0 0 -5px #cfcfcf,525px 0 0 -5px #cfcfcf,526px 0 0 -5px #cfcfcf,527px 0 0 -5px #cfcfcf,528px 0 0 -5px #cfcfcf,529px 0 0 -5px #cfcfcf,530px 0 0 -5px #cfcfcf,531px 0 0 -5px #cfcfcf,532px 0 0 -5px #cfcfcf,533px 0 0 -5px #cfcfcf,534px 0 0 -5px #cfcfcf,535px 0 0 -5px #cfcfcf,536px 0 0 -5px #cfcfcf,537px 0 0 -5px #cfcfcf,538px 0 0 -5px #cfcfcf,539px 0 0 -5px #cfcfcf,540px 0 0 -5px #cfcfcf,541px 0 0 -5px #cfcfcf,542px 0 0 -5px #cfcfcf,543px 0 0 -5px #cfcfcf,544px 0 0 -5px #cfcfcf,545px 0 0 -5px #cfcfcf,546px 0 0 -5px #cfcfcf,547px 0 0 -5px #cfcfcf,548px 0 0 -5px #cfcfcf,549px 0 0 -5px #cfcfcf,550px 0 0 -5px #cfcfcf,551px 0 0 -5px #cfcfcf,552px 0 0 -5px #cfcfcf,553px 0 0 -5px #cfcfcf,554px 0 0 -5px #cfcfcf,555px 0 0 -5px #cfcfcf,556px 0 0 -5px #cfcfcf,557px 0 0 -5px #cfcfcf,558px 0 0 -5px #cfcfcf,559px 0 0 -5px #cfcfcf,560px 0 0 -5px #cfcfcf,561px 0 0 -5px #cfcfcf,562px 0 0 -5px #cfcfcf,563px 0 0 -5px #cfcfcf,564px 0 0 -5px #cfcfcf,565px 0 0 -5px #cfcfcf,566px 0 0 -5px #cfcfcf,567px 0 0 -5px #cfcfcf,568px 0 0 -5px #cfcfcf,569px 0 0 -5px #cfcfcf,570px 0 0 -5px #cfcfcf,571px 0 0 -5px #cfcfcf,572px 0 0 -5px #cfcfcf,573px 0 0 -5px #cfcfcf,574px 0 0 -5px #cfcfcf,575px 0 0 -5px #cfcfcf,576px 0 0 -5px #cfcfcf,577px 0 0 -5px #cfcfcf,578px 0 0 -5px #cfcfcf,579px 0 0 -5px #cfcfcf,580px 0 0 -5px #cfcfcf,581px 0 0 -5px #cfcfcf,582px 0 0 -5px #cfcfcf,583px 0 0 -5px #cfcfcf,584px 0 0 -5px #cfcfcf,585px 0 0 -5px #cfcfcf,586px 0 0 -5px #cfcfcf,587px 0 0 -5px #cfcfcf,588px 0 0 -5px #cfcfcf,589px 0 0 -5px #cfcfcf,590px 0 0 -5px #cfcfcf,591px 0 0 -5px #cfcfcf,592px 0 0 -5px #cfcfcf,593px 0 0 -5px #cfcfcf,594px 0 0 -5px #cfcfcf,595px 0 0 -5px #cfcfcf,596px 0 0 -5px #cfcfcf,597px 0 0 -5px #cfcfcf,598px 0 0 -5px #cfcfcf,599px 0 0 -5px #cfcfcf,600px 0 0 -5px #cfcfcf,601px 0 0 -5px #cfcfcf,602px 0 0 -5px #cfcfcf,603px 0 0 -5px #cfcfcf,604px 0 0 -5px #cfcfcf,605px 0 0 -5px #cfcfcf,606px 0 0 -5px #cfcfcf,607px 0 0 -5px #cfcfcf,608px 0 0 -5px #cfcfcf,609px 0 0 -5px #cfcfcf,610px 0 0 -5px #cfcfcf,611px 0 0 -5px #cfcfcf,612px 0 0 -5px #cfcfcf,613px 0 0 -5px #cfcfcf,614px 0 0 -5px #cfcfcf,615px 0 0 -5px #cfcfcf,616px 0 0 -5px #cfcfcf,617px 0 0 -5px #cfcfcf,618px 0 0 -5px #cfcfcf,619px 0 0 -5px #cfcfcf,620px 0 0 -5px #cfcfcf,621px 0 0 -5px #cfcfcf,622px 0 0 -5px #cfcfcf,623px 0 0 -5px #cfcfcf,624px 0 0 -5px #cfcfcf,625px 0 0 -5px #cfcfcf,626px 0 0 -5px #cfcfcf,627px 0 0 -5px #cfcfcf,628px 0 0 -5px #cfcfcf,629px 0 0 -5px #cfcfcf,630px 0 0 -5px #cfcfcf,631px 0 0 -5px #cfcfcf,632px 0 0 -5px #cfcfcf,633px 0 0 -5px #cfcfcf,634px 0 0 -5px #cfcfcf,635px 0 0 -5px #cfcfcf,636px 0 0 -5px #cfcfcf,637px 0 0 -5px #cfcfcf,638px 0 0 -5px #cfcfcf,639px 0 0 -5px #cfcfcf,640px 0 0 -5px #cfcfcf,641px 0 0 -5px #cfcfcf,642px 0 0 -5px #cfcfcf,643px 0 0 -5px #cfcfcf,644px 0 0 -5px #cfcfcf,645px 0 0 -5px #cfcfcf,646px 0 0 -5px #cfcfcf,647px 0 0 -5px #cfcfcf,648px 0 0 -5px #cfcfcf,649px 0 0 -5px #cfcfcf,650px 0 0 -5px #cfcfcf,651px 0 0 -5px #cfcfcf,652px 0 0 -5px #cfcfcf,653px 0 0 -5px #cfcfcf,654px 0 0 -5px #cfcfcf,655px 0 0 -5px #cfcfcf,656px 0 0 -5px #cfcfcf,657px 0 0 -5px #cfcfcf,658px 0 0 -5px #cfcfcf,659px 0 0 -5px #cfcfcf,660px 0 0 -5px #cfcfcf,661px 0 0 -5px #cfcfcf,662px 0 0 -5px #cfcfcf,663px 0 0 -5px #cfcfcf,664px 0 0 -5px #cfcfcf,665px 0 0 -5px #cfcfcf,666px 0 0 -5px #cfcfcf,667px 0 0 -5px #cfcfcf,668px 0 0 -5px #cfcfcf,669px 0 0 -5px #cfcfcf,670px 0 0 -5px #cfcfcf,671px 0 0 -5px #cfcfcf,672px 0 0 -5px #cfcfcf,673px 0 0 -5px #cfcfcf,674px 0 0 -5px #cfcfcf,675px 0 0 -5px #cfcfcf,676px 0 0 -5px #cfcfcf,677px 0 0 -5px #cfcfcf,678px 0 0 -5px #cfcfcf,679px 0 0 -5px #cfcfcf,680px 0 0 -5px #cfcfcf,681px 0 0 -5px #cfcfcf,682px 0 0 -5px #cfcfcf,683px 0 0 -5px #cfcfcf,684px 0 0 -5px #cfcfcf,685px 0 0 -5px #cfcfcf,686px 0 0 -5px #cfcfcf,687px 0 0 -5px #cfcfcf,688px 0 0 -5px #cfcfcf,689px 0 0 -5px #cfcfcf,690px 0 0 -5px #cfcfcf,691px 0 0 -5px #cfcfcf,692px 0 0 -5px #cfcfcf,693px 0 0 -5px #cfcfcf,694px 0 0 -5px #cfcfcf,695px 0 0 -5px #cfcfcf,696px 0 0 -5px #cfcfcf,697px 0 0 -5px #cfcfcf,698px 0 0 -5px #cfcfcf,699px 0 0 -5px #cfcfcf,700px 0 0 -5px #cfcfcf,701px 0 0 -5px #cfcfcf,702px 0 0 -5px #cfcfcf,703px 0 0 -5px #cfcfcf,704px 0 0 -5px #cfcfcf,705px 0 0 -5px #cfcfcf,706px 0 0 -5px #cfcfcf,707px 0 0 -5px #cfcfcf,708px 0 0 -5px #cfcfcf,709px 0 0 -5px #cfcfcf,710px 0 0 -5px #cfcfcf,711px 0 0 -5px #cfcfcf,712px 0 0 -5px #cfcfcf,713px 0 0 -5px #cfcfcf,714px 0 0 -5px #cfcfcf,715px 0 0 -5px #cfcfcf,716px 0 0 -5px #cfcfcf,717px 0 0 -5px #cfcfcf,718px 0 0 -5px #cfcfcf,719px 0 0 -5px #cfcfcf,720px 0 0 -5px #cfcfcf,721px 0 0 -5px #cfcfcf,722px 0 0 -5px #cfcfcf,723px 0 0 -5px #cfcfcf,724px 0 0 -5px #cfcfcf,725px 0 0 -5px #cfcfcf,726px 0 0 -5px #cfcfcf,727px 0 0 -5px #cfcfcf,728px 0 0 -5px #cfcfcf,729px 0 0 -5px #cfcfcf,730px 0 0 -5px #cfcfcf,731px 0 0 -5px #cfcfcf,732px 0 0 -5px #cfcfcf,733px 0 0 -5px #cfcfcf,734px 0 0 -5px #cfcfcf,735px 0 0 -5px #cfcfcf,736px 0 0 -5px #cfcfcf,737px 0 0 -5px #cfcfcf,738px 0 0 -5px #cfcfcf,739px 0 0 -5px #cfcfcf,740px 0 0 -5px #cfcfcf,741px 0 0 -5px #cfcfcf,742px 0 0 -5px #cfcfcf,743px 0 0 -5px #cfcfcf,744px 0 0 -5px #cfcfcf,745px 0 0 -5px #cfcfcf,746px 0 0 -5px #cfcfcf,747px 0 0 -5px #cfcfcf,748px 0 0 -5px #cfcfcf,749px 0 0 -5px #cfcfcf,750px 0 0 -5px #cfcfcf,751px 0 0 -5px #cfcfcf,752px 0 0 -5px #cfcfcf,753px 0 0 -5px #cfcfcf,754px 0 0 -5px #cfcfcf,755px 0 0 -5px #cfcfcf,756px 0 0 -5px #cfcfcf,757px 0 0 -5px #cfcfcf,758px 0 0 -5px #cfcfcf,759px 0 0 -5px #cfcfcf,760px 0 0 -5px #cfcfcf,761px 0 0 -5px #cfcfcf,762px 0 0 -5px #cfcfcf,763px 0 0 -5px #cfcfcf,764px 0 0 -5px #cfcfcf,765px 0 0 -5px #cfcfcf,766px 0 0 -5px #cfcfcf,767px 0 0 -5px #cfcfcf,768px 0 0 -5px #cfcfcf,769px 0 0 -5px #cfcfcf,770px 0 0 -5px #cfcfcf,771px 0 0 -5px #cfcfcf,772px 0 0 -5px #cfcfcf,773px 0 0 -5px #cfcfcf,774px 0 0 -5px #cfcfcf,775px 0 0 -5px #cfcfcf,776px 0 0 -5px #cfcfcf,777px 0 0 -5px #cfcfcf,778px 0 0 -5px #cfcfcf,779px 0 0 -5px #cfcfcf,780px 0 0 -5px #cfcfcf,781px 0 0 -5px #cfcfcf,782px 0 0 -5px #cfcfcf,783px 0 0 -5px #cfcfcf,784px 0 0 -5px #cfcfcf,785px 0 0 -5px #cfcfcf,786px 0 0 -5px #cfcfcf,787px 0 0 -5px #cfcfcf,788px 0 0 -5px #cfcfcf,789px 0 0 -5px #cfcfcf,790px 0 0 -5px #cfcfcf,791px 0 0 -5px #cfcfcf,792px 0 0 -5px #cfcfcf,793px 0 0 -5px #cfcfcf,794px 0 0 -5px #cfcfcf,795px 0 0 -5px #cfcfcf,796px 0 0 -5px #cfcfcf,797px 0 0 -5px #cfcfcf,798px 0 0 -5px #cfcfcf,799px 0 0 -5px #cfcfcf,800px 0 0 -5px #cfcfcf,801px 0 0 -5px #cfcfcf,802px 0 0 -5px #cfcfcf,803px 0 0 -5px #cfcfcf,804px 0 0 -5px #cfcfcf,805px 0 0 -5px #cfcfcf,806px 0 0 -5px #cfcfcf,807px 0 0 -5px #cfcfcf,808px 0 0 -5px #cfcfcf,809px 0 0 -5px #cfcfcf,810px 0 0 -5px #cfcfcf,811px 0 0 -5px #cfcfcf,812px 0 0 -5px #cfcfcf,813px 0 0 -5px #cfcfcf,814px 0 0 -5px #cfcfcf,815px 0 0 -5px #cfcfcf,816px 0 0 -5px #cfcfcf,817px 0 0 -5px #cfcfcf,818px 0 0 -5px #cfcfcf,819px 0 0 -5px #cfcfcf,820px 0 0 -5px #cfcfcf,821px 0 0 -5px #cfcfcf,822px 0 0 -5px #cfcfcf,823px 0 0 -5px #cfcfcf,824px 0 0 -5px #cfcfcf,825px 0 0 -5px #cfcfcf,826px 0 0 -5px #cfcfcf,827px 0 0 -5px #cfcfcf,828px 0 0 -5px #cfcfcf,829px 0 0 -5px #cfcfcf,830px 0 0 -5px #cfcfcf,831px 0 0 -5px #cfcfcf,832px 0 0 -5px #cfcfcf,833px 0 0 -5px #cfcfcf,834px 0 0 -5px #cfcfcf,835px 0 0 -5px #cfcfcf,836px 0 0 -5px #cfcfcf,837px 0 0 -5px #cfcfcf,838px 0 0 -5px #cfcfcf,839px 0 0 -5px #cfcfcf,840px 0 0 -5px #cfcfcf,841px 0 0 -5px #cfcfcf,842px 0 0 -5px #cfcfcf,843px 0 0 -5px #cfcfcf,844px 0 0 -5px #cfcfcf,845px 0 0 -5px #cfcfcf,846px 0 0 -5px #cfcfcf,847px 0 0 -5px #cfcfcf,848px 0 0 -5px #cfcfcf,849px 0 0 -5px #cfcfcf,850px 0 0 -5px #cfcfcf,851px 0 0 -5px #cfcfcf,852px 0 0 -5px #cfcfcf,853px 0 0 -5px #cfcfcf,854px 0 0 -5px #cfcfcf,855px 0 0 -5px #cfcfcf,856px 0 0 -5px #cfcfcf,857px 0 0 -5px #cfcfcf,858px 0 0 -5px #cfcfcf,859px 0 0 -5px #cfcfcf,860px 0 0 -5px #cfcfcf,861px 0 0 -5px #cfcfcf,862px 0 0 -5px #cfcfcf,863px 0 0 -5px #cfcfcf,864px 0 0 -5px #cfcfcf,865px 0 0 -5px #cfcfcf,866px 0 0 -5px #cfcfcf,867px 0 0 -5px #cfcfcf,868px 0 0 -5px #cfcfcf,869px 0 0 -5px #cfcfcf,870px 0 0 -5px #cfcfcf,871px 0 0 -5px #cfcfcf,872px 0 0 -5px #cfcfcf,873px 0 0 -5px #cfcfcf,874px 0 0 -5px #cfcfcf,875px 0 0 -5px #cfcfcf,876px 0 0 -5px #cfcfcf,877px 0 0 -5px #cfcfcf,878px 0 0 -5px #cfcfcf,879px 0 0 -5px #cfcfcf,880px 0 0 -5px #cfcfcf,881px 0 0 -5px #cfcfcf,882px 0 0 -5px #cfcfcf,883px 0 0 -5px #cfcfcf,884px 0 0 -5px #cfcfcf,885px 0 0 -5px #cfcfcf,886px 0 0 -5px #cfcfcf,887px 0 0 -5px #cfcfcf,888px 0 0 -5px #cfcfcf,889px 0 0 -5px #cfcfcf,890px 0 0 -5px #cfcfcf,891px 0 0 -5px #cfcfcf,892px 0 0 -5px #cfcfcf,893px 0 0 -5px #cfcfcf,894px 0 0 -5px #cfcfcf,895px 0 0 -5px #cfcfcf,896px 0 0 -5px #cfcfcf,897px 0 0 -5px #cfcfcf,898px 0 0 -5px #cfcfcf,899px 0 0 -5px #cfcfcf,900px 0 0 -5px #cfcfcf,901px 0 0 -5px #cfcfcf,902px 0 0 -5px #cfcfcf,903px 0 0 -5px #cfcfcf,904px 0 0 -5px #cfcfcf,905px 0 0 -5px #cfcfcf,906px 0 0 -5px #cfcfcf,907px 0 0 -5px #cfcfcf,908px 0 0 -5px #cfcfcf,909px 0 0 -5px #cfcfcf,910px 0 0 -5px #cfcfcf,911px 0 0 -5px #cfcfcf,912px 0 0 -5px #cfcfcf,913px 0 0 -5px #cfcfcf,914px 0 0 -5px #cfcfcf,915px 0 0 -5px #cfcfcf,916px 0 0 -5px #cfcfcf,917px 0 0 -5px #cfcfcf,918px 0 0 -5px #cfcfcf,919px 0 0 -5px #cfcfcf,920px 0 0 -5px #cfcfcf,921px 0 0 -5px #cfcfcf,922px 0 0 -5px #cfcfcf,923px 0 0 -5px #cfcfcf,924px 0 0 -5px #cfcfcf,925px 0 0 -5px #cfcfcf,926px 0 0 -5px #cfcfcf,927px 0 0 -5px #cfcfcf,928px 0 0 -5px #cfcfcf,929px 0 0 -5px #cfcfcf,930px 0 0 -5px #cfcfcf,931px 0 0 -5px #cfcfcf,932px 0 0 -5px #cfcfcf,933px 0 0 -5px #cfcfcf,934px 0 0 -5px #cfcfcf,935px 0 0 -5px #cfcfcf,936px 0 0 -5px #cfcfcf,937px 0 0 -5px #cfcfcf,938px 0 0 -5px #cfcfcf,939px 0 0 -5px #cfcfcf,940px 0 0 -5px #cfcfcf,941px 0 0 -5px #cfcfcf,942px 0 0 -5px #cfcfcf,943px 0 0 -5px #cfcfcf,944px 0 0 -5px #cfcfcf,945px 0 0 -5px #cfcfcf,946px 0 0 -5px #cfcfcf,947px 0 0 -5px #cfcfcf,948px 0 0 -5px #cfcfcf,949px 0 0 -5px #cfcfcf,950px 0 0 -5px #cfcfcf,951px 0 0 -5px #cfcfcf,952px 0 0 -5px #cfcfcf,953px 0 0 -5px #cfcfcf,954px 0 0 -5px #cfcfcf,955px 0 0 -5px #cfcfcf,956px 0 0 -5px #cfcfcf,957px 0 0 -5px #cfcfcf,958px 0 0 -5px #cfcfcf,959px 0 0 -5px #cfcfcf,960px 0 0 -5px #cfcfcf,961px 0 0 -5px #cfcfcf,962px 0 0 -5px #cfcfcf,963px 0 0 -5px #cfcfcf,964px 0 0 -5px #cfcfcf,965px 0 0 -5px #cfcfcf,966px 0 0 -5px #cfcfcf,967px 0 0 -5px #cfcfcf,968px 0 0 -5px #cfcfcf,969px 0 0 -5px #cfcfcf,970px 0 0 -5px #cfcfcf,971px 0 0 -5px #cfcfcf,972px 0 0 -5px #cfcfcf,973px 0 0 -5px #cfcfcf,974px 0 0 -5px #cfcfcf,975px 0 0 -5px #cfcfcf,976px 0 0 -5px #cfcfcf,977px 0 0 -5px #cfcfcf,978px 0 0 -5px #cfcfcf,979px 0 0 -5px #cfcfcf,980px 0 0 -5px #cfcfcf,981px 0 0 -5px #cfcfcf,982px 0 0 -5px #cfcfcf,983px 0 0 -5px #cfcfcf,984px 0 0 -5px #cfcfcf,985px 0 0 -5px #cfcfcf,986px 0 0 -5px #cfcfcf,987px 0 0 -5px #cfcfcf,988px 0 0 -5px #cfcfcf,989px 0 0 -5px #cfcfcf,990px 0 0 -5px #cfcfcf,991px 0 0 -5px #cfcfcf,992px 0 0 -5px #cfcfcf,993px 0 0 -5px #cfcfcf,994px 0 0 -5px #cfcfcf,995px 0 0 -5px #cfcfcf,996px 0 0 -5px #cfcfcf,997px 0 0 -5px #cfcfcf,998px 0 0 -5px #cfcfcf,999px 0 0 -5px #cfcfcf,1000px 0 0 -5px #cfcfcf;transition:background-color .15s}.hs-input-range__slider::-moz-range-progress,.hs-input-range__slider::-moz-range-track{width:100%;height:30px;background:linear-gradient(180deg,#cfcfcf,#cfcfcf) 100% 50%/100% 3px no-repeat transparent}.hs-input-range__slider::-moz-range-progress{background:linear-gradient(180deg,#0199ff,#0199ff) 100% 50%/100% 3px no-repeat transparent}.hs-input-range__slider::-moz-range-thumb{appearance:none;margin:0;height:13px;width:13px;background:#0199ff;border-radius:100%;border:0;transition:background-color .15s}.hs-input-range__slider::-ms-track{width:100%;height:30px;border:0;color:transparent;background:transparent}.hs-input-range__slider::-ms-fill-lower{background:linear-gradient(180deg,#0199ff,#0199ff) 100% 50%/100% 3px no-repeat transparent}.hs-input-range__slider::-ms-fill-upper{background:linear-gradient(180deg,#cfcfcf,#cfcfcf) 100% 50%/100% 3px no-repeat transparent}.hs-input-range__slider::-ms-thumb{appearance:none;height:13px;width:13px;background:#0199ff;border-radius:100%;border:0;transition:background-color .15s;top:0;margin:0;box-shadow:none}.hs-input-range__slider:focus::-webkit-slider-thumb,.hs-input-range__slider:hover::-webkit-slider-thumb{background-color:#55c2ff}.hs-input-range__slider:focus::-moz-range-thumb,.hs-input-range__slider:hover::-moz-range-thumb{background-color:#55c2ff}.hs-input-range__slider:focus::-ms-thumb,.hs-input-range__slider:hover::-ms-thumb{background-color:#55c2ff}.hs-input-rating__container{width:95%;margin-bottom:30px;display:table;table-layout:fixed}.hs-input-rating__container section{display:table-row}.hs-input-rating__label{position:relative;display:table-cell;vertical-align:middle;text-align:center}.hs-input-rating__label input,.hs-input-rating__label svg{position:absolute;top:20px;left:0;right:0;margin-left:auto;margin-right:auto;display:block;cursor:pointer}.hs-input-rating__label svg{position:absolute;width:45px;height:45px;fill:#fff;stroke:#ccc;transform:scale(.6);transition:transform .2s ease-in-out}.hs-input-rating__label path{transition:fill .2s ease-in-out,stroke .1s ease-in-out}.hs-input-rating__is-star input{display:none}.hs-input-rating__svg-is-selected{transform:scale(.7)}.hs-input-rating__svg-is-selected path{fill:#f7e31b;stroke:#d7c508}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 .hs-button{white-space:pre-wrap}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 .hs-richtext{word-break:break-word}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68.submitted-message{overflow:auto}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 fieldset{border:0;padding:0;margin:0;max-width:500px}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 fieldset.form-columns-1 .hs-input{width:95%}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 fieldset.form-columns-1 .input{margin-right:8px}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 fieldset.form-columns-1 input[type=checkbox],.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 fieldset.form-columns-1 input[type=radio]{width:auto}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 fieldset.form-columns-2 .hs-form-field{width:50%;float:left}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 fieldset.form-columns-2 .input{margin-right:8px}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 fieldset.form-columns-3 .hs-form-field{width:32.7%;float:left}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 fieldset.form-columns-3 .input{margin-right:8px}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 label.hs-hidden{visibility:hidden}.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68 .hs-field-desc{width:100%}.hs-custom-style .hs-input,.hs-custom-style fieldset{max-width:100%}.hs-custom-style>div.form-columns-3 .hs-form-field,.hs-custom-style fieldset.form-columns-3 .hs-form-field{width:33.3%}.hs-custom-style>div>div:last-of-type .hs-input:not([type=checkbox]):not([type=radio]),.hs-custom-style fieldset>div:last-of-type .hs-input:not([type=checkbox]):not([type=radio]){width:100%;max-width:100%}.hs-custom-style>div input:not([type=image]):not([type=submit]):not([type=button]):not([type=radio]):not([type=checkbox]):not([type=file]),.hs-custom-style fieldset input:not([type=image]):not([type=submit]):not([type=button]):not([type=radio]):not([type=checkbox]):not([type=file]){box-sizing:border-box;padding:0 15px;min-height:27px}.hs-custom-style .hs-dependent-field>div .hs-input:not([type=checkbox]):not([type=radio]){width:100%}@media (max-width:400px),(min-device-width:320px) and (max-device-width:480px){.hs-custom-style .hs-input:not([type=checkbox]):not([type=radio]),.hs-custom-style fieldset{margin-right:0!important;width:100%!important}form.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68:not(.hs-video-form) .form-columns-2 .hs-form-field,form.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68:not(.hs-video-form) .form-columns-3 .hs-form-field{float:none;width:100%}form.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68:not(.hs-video-form) .form-columns-2 .hs-form-field .hs-input,form.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68:not(.hs-video-form) .form-columns-3 .hs-form-field .hs-input{width:95%}form.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68:not(.hs-video-form) .form-columns-2 .hs-form-field input[type=checkbox],form.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68:not(.hs-video-form) .form-columns-2 .hs-form-field input[type=radio],form.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68:not(.hs-video-form) .form-columns-3 .hs-form-field input[type=checkbox],form.hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68:not(.hs-video-form) .form-columns-3 .hs-form-field input[type=radio]{width:auto}}.legal-consent-container .field.hs-form-field{margin-bottom:8px}.legal-consent-container .hs-field-desc.checkbox-desc{margin:-12px 0 0 21px}.legal-consent-container .hs-form-booleancheckbox-display input{float:left}.legal-consent-container .hs-form-booleancheckbox-display>span{display:block;margin-left:20px}.legal-consent-container .hs-form-booleancheckbox-display p{margin:0;display:inline}.legal-consent-container .hs-error-msgs label{color:#f2545b}.legal-consent-container~.hs_recaptcha{margin-top:18px}.cookie-reset-container{font-size:14px;margin-bottom:10px;text-align:right}



#hs-outer-captcha-target,#hs-outer-captcha-target *{display:none;height:0;width:0}.hubspot-link__container{font-size:14px;padding-bottom:40px;position:relative;color:#9fa0a2;font-family:Helvetica Neue,Helvetica,Arial,sans-serif}.hubspot-link-text{color:#00a4bd;font-weight:400}.hubspot-link__container.sproket{color:#9fa0a2}.hubspot-link{color:#9fa0a2}.hubspot-link,.hubspot-link:hover{text-decoration:none}.hubspot-link:hover .hubspot-link-text{text-decoration:underline}.hubspot-link__icon{margin-bottom:-1px;margin-right:5px}.hubspot-link__container.sproket .hubspot-link__icon{width:30px;margin-right:0;float:left;margin-top:-9px;margin-left:-5px}

</style><script async="" src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/js"></script><script src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/a"></script></head>


<body><style type="text/css">html.hs-messages-widget-open.hs-messages-mobile,html.hs-messages-widget-open.hs-messages-mobile body{overflow:hidden!important;position:relative!important}html.hs-messages-widget-open.hs-messages-mobile body{height:100%!important;margin:0!important}#hubspot-messages-iframe-container{display:initial!important;z-index:2147483647;position:fixed!important;bottom:0!important}#hubspot-messages-iframe-container.widget-align-left{left:0!important}#hubspot-messages-iframe-container.widget-align-right{right:0!important}#hubspot-messages-iframe-container.internal{z-index:1016}#hubspot-messages-iframe-container.internal iframe{min-width:108px}#hubspot-messages-iframe-container .shadow-container{display:initial!important;z-index:-1;position:absolute;width:0;height:0;bottom:0;content:""}#hubspot-messages-iframe-container .shadow-container.internal{display:none!important}#hubspot-messages-iframe-container .shadow-container.active{width:400px;height:400px}#hubspot-messages-iframe-container iframe{display:initial!important;width:100%!important;height:100%!important;border:none!important;position:absolute!important;bottom:0!important;right:0!important;background:transparent!important}</style>
	<div id="wrap">

	  	<!-- Navigation -->
	  	<nav id="nav">
	<div id="nav-list">
		<a href="https://interrupt.memfault.com/blog/">Home</a>

		<!-- Nav pages -->
	  
	    
	  
	    
	      <a href="https://interrupt.memfault.com/blog/about" title="About">About</a>
	    
	  
	    
	      <a href="https://interrupt.memfault.com/blog/authors" title="Authors">Authors</a>
	    
	  
	    
	      <a href="https://interrupt.memfault.com/blog/code-of-conduct" title="Code of Conduct">Code of Conduct</a>
	    
	  
	    
	      <a href="https://interrupt.memfault.com/blog/contributing" title="Contributing">Contributing</a>
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	      <a href="https://interrupt.memfault.com/blog/tags" title="Tags">Tags</a>
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
    
    <!-- Nav links -->
	  <!-- TODO <a id="theme-toggle" href="#">Toggle dark mode</a> -->
<a href="https://github.com/memfault/interrupt" target="_blank">Github</a>
<a href="https://memfault.com/" target="_blank">About Memfault</a>

	</div>
  
  <!-- Nav footer -->
  <footer>
	
	<!-- Your custom nav footer here -->
	
</footer>

</nav>


    <!-- Icon menu -->
	  <a id="nav-menu">
	  	<div id="menu"></div>
	  </a>

      <!-- Header -->
      <header id="header">
  <a href="https://interrupt.memfault.com/blog/">
    <img id="logo" src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/interrupt-logo.svg" alt="Interrupt Logo">
    <h1>Interrupt</h1>
  </a>
  <br>
  <a href="https://interrupt.memfault.com/blog/feed.xml">
    <svg class="svg-icon rss"><use xlink:href="/blog/img/social-icons.svg#rss"></use></svg><span>RSS</span>
  </a>&nbsp;&nbsp;&nbsp;&nbsp;
  <a href="https://go.memfault.com/interrupt-subscribe" target="_blank">Subscribe</a>&nbsp;&nbsp;&nbsp;&nbsp;
  <a href="https://interrupt.memfault.com/blog/contributing">Contribute</a>&nbsp;&nbsp;&nbsp;&nbsp;
  <a href="https://interrupt.memfault.com/blog/tags">Tags</a>&nbsp;&nbsp;
  <a href="https://interrupt-slack.herokuapp.com/" target="_blank">
    <svg class="svg-icon slack"><use xlink:href="/blog/img/social-icons.svg#slack"></use></svg><span>Slack</span>
  </a>&nbsp;&nbsp;&nbsp;&nbsp;
</header>


    <!-- Main content -->
	  <div id="split-container-wrapper">
      <div id="split-container">
        <main>

          <article id="post-page">
    
    

    <script src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/anchor.js"></script>
    <h2 id="how-to-debug-a-hardfault-on-an-arm-cortex-m-mcu">How to debug a HardFault on an ARM Cortex-M MCU<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#how-to-debug-a-hardfault-on-an-arm-cortex-m-mcu" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h2>
    <div class="by-line">
       <time datetime="2019-11-20T00:00:00+00:00">20 Nov 2019</time>
       
       <span>by <a href="https://interrupt.memfault.com/blog/authors/chris">Chris Coleman</a></span>
       
    </div>
    <div class="content">

        <p>Faults happen on embedded devices all the time for a variety of reasons – ranging from
something as simple as a NULL pointer dereference to something more unexpected like
running a faulty code path only when in a zero-g environment on the Tower of Terror in
Disneyland<sup id="fnref:14"><a href="#fn:14" class="footnote">1</a></sup>. It’s important for any embedded engineer to understand how to debug and resolve
this class of issue quickly.</p>

<!-- excerpt start -->

<p>In this article, we explain how to debug faults on ARM Cortex-M based
 devices. In the process, we
learn about fault registers, how to automate fault analysis, and figure 
out ways to recover from
some faults without rebooting the MCU. We include practical examples, 
with a step by step walk-through on how to investigate them.</p>

<!-- excerpt end -->

<div class="newsletter">
  <p class="newsletter-content">Like Interrupt? <a class="newsletter-link" href="https://go.memfault.com/interrupt-subscribe" target="_blank">Subscribe</a> to get our latest posts straight to your mailbox.</p>
</div>

<div id="toc">

  <h2 class="no_toc" id="table-of-contents">Table of Contents<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#table-of-contents" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h2>

  <!-- prettier-ignore -->
<ul id="markdown-toc">
  <li><a href="#determining-what-caused-the-fault" id="markdown-toc-determining-what-caused-the-fault">Determining What Caused The Fault</a></li>
  <li>
<a href="#relevant-status-registers" id="markdown-toc-relevant-status-registers">Relevant Status Registers</a>    <ul>
      <li><a href="#cfsr" id="markdown-toc-cfsr">Configurable Fault Status Registers (CFSR) - 0xE000ED28</a></li>
      <li><a href="#hardfault-status-register-hfsr---0xe000ed2c" id="markdown-toc-hardfault-status-register-hfsr---0xe000ed2c">HardFault Status Register (HFSR) - 0xE000ED2C</a></li>
    </ul>
  </li>
  <li><a href="#registers-prior-to-exception" id="markdown-toc-registers-prior-to-exception">Recovering the Call Stack</a></li>
  <li>
<a href="#automating-the-analysis" id="markdown-toc-automating-the-analysis">Automating the Analysis</a>    <ul>
      <li><a href="#halting--determining-core-register-state" id="markdown-toc-halting--determining-core-register-state">Halting &amp; Determining Core Register State</a></li>
      <li><a href="#fault-register-analyzers" id="markdown-toc-fault-register-analyzers">Fault Register Analyzers</a></li>
      <li><a href="#postmortem-analysis" id="markdown-toc-postmortem-analysis">Postmortem Analysis</a></li>
    </ul>
  </li>
  <li><a href="#recovering-from-a-fault" id="markdown-toc-recovering-from-a-fault">Recovering From A Fault</a></li>
  <li>
<a href="#examples" id="markdown-toc-examples">Examples</a>    <ul>
      <li><a href="#bad-pc-mpu-fault" id="markdown-toc-bad-pc-mpu-fault">eXecute Never Fault</a></li>
      <li><a href="#bad-address-read-example" id="markdown-toc-bad-address-read-example">Bad Address Read</a></li>
      <li><a href="#coprocessor-fault-example" id="markdown-toc-coprocessor-fault-example">Coprocessor Fault</a></li>
      <li><a href="#imprecise-error-code-example" id="markdown-toc-imprecise-error-code-example">Imprecise Fault</a></li>
      <li><a href="#stkerr-example" id="markdown-toc-stkerr-example">Fault Entry Exception</a></li>
      <li><a href="#usage-fault-recovery-example" id="markdown-toc-usage-fault-recovery-example">Recovering from a UsageFault <strong>without</strong> a SYSRESET</a></li>
    </ul>
  </li>
</ul>

</div>

<h2 id="determining-what-caused-the-fault">Determining What Caused The Fault<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#determining-what-caused-the-fault" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h2>

<p>All MCUs in the Cortex-M series have several different pieces of 
state which can be analyzed when a fault takes place to trace down what 
went wrong.</p>

<p>First we will explore the dedicated fault status registers that are present on all Cortex-M MCUs except the Cortex-M0.</p>

<p>If you are trying to debug a Cortex-M0, you can skip ahead to the <a href="#registers-prior-to-exception">next section</a> where we discuss how to recover the core register state and instruction being executed at the time of the exception.</p>

<blockquote>
  <p>NOTE: If you already know the state to inspect when a fault occurs, you may want to skip ahead to the section about how to <a href="#automating-the-analysis">automate the analysis</a>.</p>
</blockquote>

<h2 id="relevant-status-registers">Relevant Status Registers<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#relevant-status-registers" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h2>

<h3 id="cfsr">Configurable Fault Status Registers (CFSR) - 0xE000ED28<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#cfsr" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h3>

<p>This 32 bit register contains a summary of the fault(s) which took 
place and resulted in the exception. The register is comprised of three 
different status registers – UsageFault, BusFault &amp; MemManage Fault 
Status Registers:</p>

<p><img src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/cfsr.png" alt=""></p>

<p>The register can be accessed via a 32 bit read at <code class="highlighter-rouge">0xE000ED28</code> or each register can be read individually. For example, in GDB it would look something like this:</p>

<ul>
  <li>Entire CFSR - <code class="highlighter-rouge">print/x *(uint32_t *) 0xE000ED28</code>
</li>
  <li>
<a href="#ufsr">UsageFault Status Register (UFSR)</a> - <code class="highlighter-rouge">print/x *(uint16_t *)0xE000ED2A</code>
</li>
  <li>
<a href="#bfsr">BusFault Status Register (BFSR)</a> - <code class="highlighter-rouge">print/x *(uint8_t *)0xE000ED29</code>
</li>
  <li>
<a href="#mmfsr">MemManage Status Register (MMFSR)</a> - <code class="highlighter-rouge">print/x *(uint8_t *)0xE000ED28</code>
</li>
</ul>

<blockquote>
  <p>NOTE: If multiple faults have occurred, bits related to several 
faults may be set. Fields are only cleared by a system reset or by 
writing a 1 to them.</p>
</blockquote>

<h4 id="ufsr">UsageFault Status Register (UFSR) - 0xE000ED2A<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#ufsr" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<p>This register is a 2 byte register which summarizes any faults that 
are not related to memory access failures, such as executing invalid 
instructions or trying to enter invalid states.</p>

<p><img src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/ufsr.png" alt=""></p>

<p>where,</p>

<ul>
  <li>
<code class="highlighter-rouge">DIVBYZERO</code> - Indicates a divide instruction was executed where the denominator was zero. This fault is <a href="#configurable-usage-faults">configurable</a>.</li>
  <li>
<code class="highlighter-rouge">UNALIGNED</code> - Indicates an unaligned access operation occurred. Unaligned multiple word accesses, such as accessing a <code class="highlighter-rouge">uint64_t</code> that is not <code class="highlighter-rouge">8-byte</code> aligned, will <em>always</em>
 generate this fault. With the exception of Cortex-M0 MCUs, whether or 
not unaligned accesses below 4 bytes generate a fault is also <a href="#configurable-usage-faults">configurable</a>.</li>
  <li>
<code class="highlighter-rouge">NOCP</code> - Indicates that a Cortex-M coprocessor instruction was issued but the coprocessor was
disabled or not present. One common case where this fault happens is when code is compiled to use the Floating Point extension (<code class="highlighter-rouge">-mfloat-abi=hard</code> <code class="highlighter-rouge">-mfpu=fpv4-sp-d16</code>) but the coprocessor was not <a href="https://interrupt.memfault.com/blog/cortex-m-rtos-context-switching#fpu-config-options">enabled</a> on boot.</li>
  <li>
<code class="highlighter-rouge">INVPC</code> - Indicates an integrity check failure on <code class="highlighter-rouge">EXC_RETURN</code>. We’ll explore an example <a href="#coprocessor-fault-example">below</a>. <a href="https://interrupt.memfault.com/blog/cortex-m-rtos-context-switching#exc-return-info"><code class="highlighter-rouge">EXC_RETURN</code></a> is the value branched to upon return from an exception. If this fault flag is set, it means a reserved <code class="highlighter-rouge">EXC_RETURN</code> value was used on exception exit.</li>
  <li>
<code class="highlighter-rouge">INVSTATE</code> - Indicates the processor has tried to execute an instruction with an invalid
<em>Execution Program Status Register</em> (<strong>EPSR</strong>) 
value. Among other things the ESPR tracks whether or not the processor 
is in thumb mode state. Instructions which use “interworking addresses”<sup id="fnref:1"><a href="#fn:1" class="footnote">2</a></sup> (<code class="highlighter-rouge">bx</code> &amp; <code class="highlighter-rouge">blx</code> or <code class="highlighter-rouge">ldr</code> &amp; <code class="highlighter-rouge">ldm</code> when loading a <code class="highlighter-rouge">pc</code>-relative value) must set <code class="highlighter-rouge">bit[0]</code> of the instruction to 1 as this is used to update <code class="highlighter-rouge">ESPR.T</code>. If this rule is violated, a <code class="highlighter-rouge">INVSTATE</code>
 exception will be generated. When writing C code, the compiler will 
take care of this automatically, but this is a common bug which can 
arise when hand-writing assembly.</li>
  <li>
<code class="highlighter-rouge">UNDEFINSTR</code> - Indicates an 
undefined instruction was executed. This can happen on exception exit if
 the stack got corrupted. A compiler may emit undefined instructions as 
well for code paths that <em>should</em> be unreachable.</li>
</ul>

<h5 id="configurable-usage-faults">Configurable UsageFault<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#configurable-usage-faults" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h5>

<p>It is worth noting that some classes of UsageFaults are configurable via the <em>Configuration and Control Register</em> (<strong>CCR</strong>) located at address <code class="highlighter-rouge">0xE000ED14</code>.</p>

<ul>
  <li>Bit 4 (<code class="highlighter-rouge">DIV_0_TRP</code>) - Controls whether or not divide by zeros will trigger a fault.</li>
  <li>Bit 3 (<code class="highlighter-rouge">UNALIGN_TRP</code>) - Controls whether or not unaligned accesses will always generate a fault.</li>
</ul>

<blockquote>
  <p>NOTE: On reset both of these optional faults are disabled. It is generally a good idea to enable <code class="highlighter-rouge">DIV_0_TRP</code> to catch mathematical errors in your code.</p>
</blockquote>

<h4 id="bfsr">BusFault Status Register (BFSR) - 0xE000ED29<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#bfsr" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<p>This register is a 1 byte register which summarizes faults related to instruction prefetch or memory access failures.</p>

<p><img src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/bfsr.png" alt=""></p>

<ul>
  <li>
<code class="highlighter-rouge">BFARVALID</code> - Indicates that the <em>Bus Fault Address Register</em> (<strong>BFAR</strong>), a 32 bit register located at <code class="highlighter-rouge">0xE000ED38</code>, holds the address which triggered the fault. We’ll walk through an example using this info <a href="#bad-address-read-example">below</a>.</li>
  <li>
<code class="highlighter-rouge">LSPERR</code> &amp; <code class="highlighter-rouge">STKERR</code>
 - Indicates that a fault occurred during lazy state preservation or 
during exception entry, respectively. Both are situations where the 
hardware is <a href="https://interrupt.memfault.com/blog/cortex-m-rtos-context-switching#context-state-stacking">automatically saving state on the stack</a>.
 One way this error may occur is if the stack in use overflows off the 
valid RAM address range while trying to service an exception. We’ll go 
over an example <a href="#stkerr-example">below</a>.</li>
  <li>
<code class="highlighter-rouge">UNSTKERR</code> - Indicates that a fault
 occurred trying to return from an exception. This typically arises if 
the stack was corrupted while the exception was running or the stack 
pointer was changed and its contents were not initialized correctly.</li>
  <li>
<code class="highlighter-rouge">IMPRECISERR</code> - This flag is <em>very</em>
 important. It tells us whether or not the hardware was able to 
determine the exact location of the fault. We will explore some debug 
strategies when this flag is set in the <a href="#imprecise-error-debug">next section</a> and walk through a code exampe <a href="#imprecise-error-code-example">below</a>.</li>
  <li>
<code class="highlighter-rouge">PRECISERR</code> - Indicates that the instruction which was executing prior to exception entry triggered the fault.</li>
</ul>

<h5 id="imprecise-error-debug">Imprecise Bus Error Debug Tips<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#imprecise-error-debug" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h5>

<p>Imprecise errors are one of the hardest classes of faults to debug. 
They result asynchronously to instruction execution flow. This means the
 registers stacked on exception entry will <strong>not</strong> point to the code that caused the exception.</p>

<p>Instruction fetches and data loads should always generate <em>synchronous</em> faults for Cortex-M devices and be precise. Conversely, store operations can generate <em>asynchronous</em>
 faults. This is because writes will sometimes be buffered prior to 
being flushed to prevent pipeline stalls so the program counter will 
advance before the actual data store completes.</p>

<p>When debugging an imprecise error, you will want to inspect the code 
around the area reported by the exception for a store that looks 
suspicious. If the MCU has support for the ARM <em>Embedded Trace Macrocell</em> (<strong>ETM</strong>), the history of recently executed instructions can be viewed by some debuggers<sup id="fnref:8"><a href="#fn:8" class="footnote">3</a></sup>.</p>

<h5 id="auxiliary-control-register-actlr---0xe000e008">Auxiliary Control Register (ACTLR) - 0xE000E008<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#auxiliary-control-register-actlr---0xe000e008" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h5>

<p>This register allows for some hardware optimizations or features to 
be disabled typically at the cost of overall performance or interrupt 
latency. The exact configuration options available are specific to the 
Cortex-M implementation being used.</p>

<p id="cortex-m3-m4-debug-trick">For the Cortex M3 &amp; Cortex M4 <strong>only</strong>, there is a trick to make all <code class="highlighter-rouge">IMPRECISE</code> accesses <code class="highlighter-rouge">PRECISE</code> by disabling any write buffering. This can be done by setting bit 1 (<code class="highlighter-rouge">DISDEFWBUF</code>) of the register to 1.</p>

<p>For the Cortex M7, there is <strong>no</strong> way to force all stores to be synchronous / precise.</p>

<h5 id="auxiliary-bus-fault-status-register-abfsr---0xe000efa8">Auxiliary Bus Fault Status Register (ABFSR) - 0xE000EFA8<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#auxiliary-bus-fault-status-register-abfsr---0xe000efa8" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h5>

<p>This register <strong>only</strong> exists for Cortex-M7 devices. When an <code class="highlighter-rouge">IMPRECISE</code> error occurs it will at least give us an indication of what memory bus the fault occurred on<sup id="fnref:7"><a href="#fn:7" class="footnote">4</a></sup>:</p>

<p><img src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/abfsr.png" alt=""></p>

<p>A full discussion of memory interfaces is outside the scope of this 
article but more details can be found in the reference manual <sup id="fnref:7:1"><a href="#fn:7" class="footnote">4</a></sup>.</p>

<h4 id="mmfsr">MemManage Status Register (MMFSR) - 0xE000ED28<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#mmfsr" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<p>This register reports Memory Protection Unit faults.</p>

<p>Typically MPU faults will only trigger if the MPU has been <a href="https://interrupt.memfault.com/blog/fix-bugs-and-secure-firmware-with-the-mpu">configured and enabled</a>
 by the firmware. However, there are a few memory access errors that 
will always result in a MemManage fault – such as trying to execute code
 from the system address range (<code class="highlighter-rouge">0xExxx.xxxx</code>).</p>

<p>The layout of the register looks like this:</p>

<p><img src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/mmfsr.png" alt=""></p>

<p>where,</p>

<ul>
  <li>
<code class="highlighter-rouge">MMARVALID</code> - Indicates that the <em>MemManage Fault Address Register</em> (<strong>MMFAR</strong>), a 32 bit register located at <code class="highlighter-rouge">0xE000ED34</code>, holds the address which triggered the MemManage fault.</li>
  <li>
<code class="highlighter-rouge">MLSPERR</code> &amp; <code class="highlighter-rouge">MSTKERR</code>
 - Indicates that a MemManage fault occurred during lazy state 
preservation or exception entry, respectively. For example, this could 
happen if an MPU region is being used to detect <a href="https://interrupt.memfault.com/blog/fix-bugs-and-secure-firmware-with-the-mpu">stack overflows</a>.</li>
  <li>
<code class="highlighter-rouge">MUNSTKERR</code> - Indicates that a fault occurred while returning from an exception</li>
  <li>
<code class="highlighter-rouge">DACCVIOL</code> - Indicates that a data access triggered the MemManage fault.</li>
  <li>
<code class="highlighter-rouge">IACCVIOL</code> - Indicates that an attempt to execute an instruction triggered an MPU or Execute Never (XN) fault. We’ll explore an example <a href="#bad-pc-mpu-fault">below</a>.</li>
</ul>

<h3 id="hardfault-status-register-hfsr---0xe000ed2c">HardFault Status Register (HFSR) - 0xE000ED2C<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#hardfault-status-register-hfsr---0xe000ed2c" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h3>

<p>This registers explains the reason a HardFault exception was triggered.</p>

<p><img src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/hfsr.png" alt=""></p>

<p>There’s not too much information in this register but we will go over the fields real quickly</p>

<ul>
  <li>
<code class="highlighter-rouge">DEBUGEVT</code> - Indicates that a debug event (i.e executing a breakpoint instruction) occurred while the debug subsystem was not enabled</li>
  <li>
<code class="highlighter-rouge">FORCED</code> - This means a 
configurable fault (i.e. the fault types we discussed in previous 
sections) was escalated to a HardFault, either because the configurable 
fault handler was not enabled or a fault occurred within the handler.</li>
  <li>
<code class="highlighter-rouge">VECTTBL</code> - Indicates a fault 
occurred because of an issue reading from an address in the vector 
table. This is pretty atypical but could happen if there is a bad 
address in the vector table and an unexpected interrupt fires.</li>
</ul>

<h2 id="registers-prior-to-exception">Recovering the Call Stack<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#registers-prior-to-exception" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h2>

<p>To fix a fault, we will want to determine what code was running when 
the fault occurred. To accomplish this, we need to recover the register 
state at the time of exception entry.</p>

<p>If the fault is readily reproducible and we have a debugger attached 
to the board, we can manually add a breakpoint for the function which 
handles the exception. In GDB this will look something like</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nb">break </span>HardFault_Handler
</code></pre></div></div>

<p>Upon exception entry some registers will always be automatically 
saved on the stack. Depending on whether or not an FPU is in use, either
 a <a href="https://interrupt.memfault.com/blog/cortex-m-rtos-context-switching#basic-context-state-frame">basic</a> or <a href="https://interrupt.memfault.com/blog/cortex-m-rtos-context-switching#extended-context-state-frame">extended</a> stack frame will be pushed by hardware.</p>

<p id="determine-pre-exception-sp">Regardless, the hardware will <em>always</em>
 push the same core set of registers to the very top of the stack which 
was active prior to entering the exception. ARM Cortex-M devices have <a href="https://interrupt.memfault.com/blog/cortex-m-rtos-context-switching#stack-pointers-and-usage">two stack pointers</a>, <code class="highlighter-rouge">msp</code> &amp; <code class="highlighter-rouge">psp</code>. Upon exception entry, the active stack pointer is encoded in bit 2 of the <code class="highlighter-rouge">EXC_RETURN</code> value pushed to the link register. If the bit is set, the <code class="highlighter-rouge">psp</code> was active prior to exception entry, else the <code class="highlighter-rouge">msp</code> was active.</p>

<p>Let’s look at the state when we break in <code class="highlighter-rouge">HardFault_Handler</code> for a pathological example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">illegal_instruction_execution</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">bad_instruction</span><span class="p">)(</span><span class="kt">void</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xE0000000</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">bad_instruction</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) p/x $lr
$4 = 0xfffffffd

# psp was active prior to exception if bit 2 is set
# otherwise, the msp was active
(gdb) p/x $lr&amp;(1&lt;&lt;2)
$5 = 0x4

# First eight values on stack will always be:
# r0, r1, r2, r3, r12, LR, pc, xPSR
(gdb) p/a *(uint32_t[8] *)$psp
$16 = {
  0x0 &lt;g_pfnVectors&gt;,
  0x200003c4 &lt;ucHeap+604&gt;,
  0x10000000,
  0xe0000000,
  0x200001b8 &lt;ucHeap+80&gt;,
  0x61 &lt;illegal_instruction_execution+16&gt;,
  0xe0000000,
  0x80000000
}
</code></pre></div></div>

<p>Offset 6 and 7 in the array dumped hold the LR (<code class="highlighter-rouge">illegal_instruction_execution</code>) &amp; PC (<code class="highlighter-rouge">0xe0000000</code>) so we now can see exactly where the fault originated!</p>

<h2 class="no_toc" id="faults-from-faults">Faults from Faults!<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#faults-from-faults" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h2>

<p>The astute observer might wonder what happens when a new fault occurs
 in the code dealing with a fault.
If you have enabled configurable fault handlers (i.e MemManage, 
BusFault, or UsageFault), a fault generated in these handlers will 
trigger a HardFault.</p>

<p>Once in the HardFault Handler, the ARM Core is operating at a 
non-configurable priority level, -1. At this level or above, a fault 
will put the processor in an unrecoverable state where a reset is 
expected. This state is known as <strong>Lockup</strong>.</p>

<p>Typically, the processor will automatically reset upon entering 
lockup but this is not a requirement per the specification. For example,
 you may have to enable a hardware watchdog for a reset to take place. 
It’s worth double checking the reference manual for the MCU being used 
for clarification.</p>

<p>When a debugger is attached, lockup often has a different behavior. For example, on the NRF52840,
“Reset from CPU lockup is disabled if the device is in debug interface mode”<sup id="fnref:11"><a href="#fn:11" class="footnote">5</a></sup>.</p>

<p>When a lockup happens, the processor will repeatedly fetch the same fixed instruction, <code class="highlighter-rouge">0xFFFFFFFE</code> or the instruction which triggered the lockup, in a loop until a reset occurs.</p>

<blockquote>
  <p>Fun Fact: Whether or not some classes of MemManage or BusFaults trigger a fault from an exception
is actually configurable via the MPU_CTRL.HFNMIENA &amp; CCR.BFHFNMIGN register fields, respectively.</p>
</blockquote>

<h2 id="automating-the-analysis">Automating the Analysis<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#automating-the-analysis" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h2>

<p>At this point we have gone over all the pieces of information which 
can be manually examined to determine what caused a fault. While this 
might be fun the first couple times, it can become a tiresome and error 
prone process if you wind up doing it often. In the following sections 
we’ll explore how we can automate this analysis!</p>

<h3 id="halting--determining-core-register-state">Halting &amp; Determining Core Register State<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#halting--determining-core-register-state" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h3>

<p>What if we are trying to debug an issue that is <strong>not</strong> 
easy to reproduce? Even if we have a debugger attached, useful state may
 be overwritten before we have a chance to halt the debugger and take a 
look.</p>

<p>The first thing we can do is to programmatically trigger a breakpoint when the system faults:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// NOTE: If you are using CMSIS, the registers can also be</span>
<span class="c1">// accessed through CoreDebug-&gt;DHCSR &amp; CoreDebug_DHCSR_C_DEBUGEN_Msk</span>
<span class="cp">#define HALT_IF_DEBUGGING()                              \
  do {                                                   \
    if ((*(volatile uint32_t *)0xE000EDF0) &amp; (1 &lt;&lt; 0)) { \
      __asm("bkpt 1");                                   \
    }                                                    \
} while (0)
</span></code></pre></div></div>

<p><a href="#registers-prior-to-exception">Above</a>, we discussed how 
to hand unroll the register state prior to the exception taking place. 
Let’s explore how we can instrument the code to make this a less painful
 process.</p>

<p>First, we can easily define a C struct to represent the register stacking:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">ContextStateFrame</span> <span class="p">{</span>
  <span class="kt">uint32_t</span> <span class="n">r0</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">r1</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">r2</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">r3</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">r12</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">lr</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">return_address</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">xpsr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">sContextStateFrame</span><span class="p">;</span>
</code></pre></div></div>

<p>We can determine the stack pointer that was active prior to the 
exception using a small assembly shim that applies the logic discussed <a href="#determine-pre-exception-sp">above</a> and passes the active stack pointer as an argument into <code class="highlighter-rouge">my_fault_handler_c</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#define HARDFAULT_HANDLING_ASM(_x)               \</span>
  __asm volatile<span class="o">(</span>                                <span class="se">\</span>
      <span class="s2">"tst lr, #4 </span><span class="se">\n</span><span class="s2">"</span>                            <span class="se">\</span>
      <span class="s2">"ite eq </span><span class="se">\n</span><span class="s2">"</span>                                <span class="se">\</span>
      <span class="s2">"mrseq r0, msp </span><span class="se">\n</span><span class="s2">"</span>                         <span class="se">\</span>
      <span class="s2">"mrsne r0, psp </span><span class="se">\n</span><span class="s2">"</span>                         <span class="se">\</span>
      <span class="s2">"b my_fault_handler_c </span><span class="se">\n</span><span class="s2">"</span>                  <span class="se">\</span>
                                                 <span class="o">)</span>
</code></pre></div></div>

<p id="my-fault-handler-c">Finally, we can put together <code class="highlighter-rouge">my_fault_handler_c</code> that looks something like:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Disable optimizations for this function so "frame" argument</span>
<span class="c1">// does not get optimized away</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">optimize</span><span class="p">(</span><span class="s">"O0"</span><span class="p">)))</span>
<span class="kt">void</span> <span class="nf">my_fault_handler_c</span><span class="p">(</span><span class="n">sContextStateFrame</span> <span class="o">*</span><span class="n">frame</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// If and only if a debugger is attached, execute a breakpoint</span>
  <span class="c1">// instruction so we can take a look at what triggered the fault</span>
  <span class="n">HALT_IF_DEBUGGING</span><span class="p">();</span>

  <span class="c1">// Logic for dealing with the exception. Typically:</span>
  <span class="c1">//  - log the fault which occurred for postmortem analysis</span>
  <span class="c1">//  - If the fault is recoverable,</span>
  <span class="c1">//    - clear errors and return back to Thread Mode</span>
  <span class="c1">//  - else</span>
  <span class="c1">//    - reboot system</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now when a fault occurs and a debugger is attached, we will 
automatically hit a breakpoint and be able to look at the register 
state!
Re-examining our <code class="highlighter-rouge">illegal_instruction_execution</code> example we have:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0x00000244 in my_fault_handler_c (frame=0x200005d8 &lt;ucHeap+1136&gt;) at ./cortex-m-fault-debug/startup.c:94
94	  HALT_IF_DEBUGGING();
(gdb) p/a *frame
$18 = {
  r0 = 0x0 &lt;g_pfnVectors&gt;,
  r1 = 0x200003c4 &lt;ucHeap+604&gt;,
  r2 = 0x10000000,
  r3 = 0xe0000000,
  r12 = 0x200001b8 &lt;ucHeap+80&gt;,
  lr = 0x61 &lt;illegal_instruction_execution+16&gt;,
  return_address = 0xe0000000,
  xpsr = 0x80000000
}
</code></pre></div></div>

<p>Furthermore, we now have a variable we can read stack info from and a C function we can easily extend for postportem analysis!</p>

<h3 id="fault-register-analyzers">Fault Register Analyzers<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#fault-register-analyzers" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h3>

<h4 id="instrumenting-the-code">Instrumenting the code<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#instrumenting-the-code" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<p>Many Real Time Operating Systems (<strong>RTOS</strong>) targetting Cortex-M devices will add options to dump
verbose fault register information to the console upon crash. Some examples include Arm Mbed OS<sup id="fnref:2"><a href="#fn:2" class="footnote">6</a></sup>
and Zephyr<sup id="fnref:3"><a href="#fn:3" class="footnote">7</a></sup>. For example, with Zephyr, the <code class="highlighter-rouge">illegal_instruction_execution()</code> crash looks like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>***** MPU FAULT *****
  Instruction Access Violation
***** Hardware exception *****
Current thread ID = 0x20000074
Faulting instruction address = 0xe0000000
Fatal fault in thread 0x20000074! Aborting.
</code></pre></div></div>

<p>This approach has a couple notable limitations:</p>

<ul>
  <li>It bloats the code &amp; data size of the binary image and consequently often gets turned off.</li>
  <li>It can increase the stack size requirements for the fault handler (due to printf calls)</li>
  <li>It requires a firmware update to improve or fix issues with the analyzers</li>
  <li>It requires a console session be active to see what fault 
occurred. Furthermore, this can be flaky if the system is in a crashed 
state.</li>
</ul>

<h4 id="debugger-plugins">Debugger Plugins<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#debugger-plugins" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<p>Many embedded IDEs expose a system view that can be used to look at 
registers. The registers will often be decoded into human readable 
descriptions. These implementations typically leverage the CMSIS <em>System View Description</em> (<strong>SVD</strong>) format<sup id="fnref:4"><a href="#fn:4" class="footnote">8</a></sup>,
 a standardized XML file format for describing the memory mapped 
registers in an ARM MCU. Most silicon vendors expose this information on
 their own website, ARM’s website<sup id="fnref:5"><a href="#fn:5" class="footnote">9</a></sup>, or provide the files upon request.</p>

<p id="pycortex-svd-gdb-setup">You can even load these files in GDB using PyCortexMDebug<sup id="fnref:6"><a href="#fn:6" class="footnote">10</a></sup>, a <a href="https://interrupt.memfault.com/blog/automate-debugging-with-gdb-python-api#getting-started-with-gdb-python">GDB python</a> script .</p>

<p>To use the utility, all you need to do is update your <code class="highlighter-rouge">.gdbinit</code> to use PyPi packages from your environment (instructions <a href="https://interrupt.memfault.com/blog/using-pypi-packages-with-GDB#3-append-syspath-to-gdbs-python">here</a>) and then run:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone git@github.com:bnahill/PyCortexMDebug.git
<span class="c"># Check out Python 2 compatible code</span>
<span class="nv">$ </span>git checkout 77af54e
<span class="nv">$ </span><span class="nb">cd </span>PyCortexMDebug
<span class="nv">$ </span>python setup.py <span class="nb">install</span>
</code></pre></div></div>

<p>When you next start gdb, you can source the <code class="highlighter-rouge">svd_gdb.py</code> script and use it to start inspecting registers. Here’s some output for the svd plugin we will use in the examples <a href="#svd-usage-example">below</a>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) source cmdebug/svd_gdb.py
(gdb) svd_load cortex-m4-scb.svd
(gdb) svd
Available Peripherals:
    ...
	SCB:        System control block
    ...
(gdb) svd SCB
Registers in SCB:
    ...
	CFSR_UFSR_BFSR_MMFSR:      524288  Configurable fault status register
    ...
(gdb) svd SCB CFSR_UFSR_BFSR_MMFSR
Fields in SCB CFSR_UFSR_BFSR_MMFSR:
	IACCVIOL:     0  Instruction access violation flag
	DACCVIOL:     0  Data access violation flag
	MUNSTKERR:    0  Memory manager fault on unstacking for a return from exception
	MSTKERR:      0  Memory manager fault on stacking for exception entry.
	MLSPERR:      0
	MMARVALID:    0  Memory Management Fault Address Register (MMAR) valid flag
	IBUSERR:      1  Instruction bus error
	PRECISERR:    0  Precise data bus error
	IMPRECISERR:  0  Imprecise data bus error
	UNSTKERR:     0  Bus fault on unstacking for a return from exception
	STKERR:       0  Bus fault on stacking for exception entry
	LSPERR:       0  Bus fault on floating-point lazy state preservation
	BFARVALID:    0  Bus Fault Address Register (BFAR) valid flag
	UNDEFINSTR:   0  Undefined instruction usage fault
	INVSTATE:     1  Invalid state usage fault
	INVPC:        0  Invalid PC load usage fault
	NOCP:         0  No coprocessor usage fault.
	UNALIGNED:    0  Unaligned access usage fault
	DIVBYZERO:    0  Divide by zero usage fault
</code></pre></div></div>

<h3 id="postmortem-analysis">Postmortem Analysis<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#postmortem-analysis" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h3>

<p>The previous two approaches are only helpful if we have a debug or 
physical connection to the device. Once the product has shipped and is 
out in the field these strategies will not help to triage what went 
wrong on devices.</p>

<p>One approach is to simply try and reproduce the issue on site. This 
is a guessing game (are you
actually reproducing the same issue the customer hit?), can be a huge 
time sink and in some cases is not even particularly feasible<sup id="fnref:14:1"><a href="#fn:14" class="footnote">1</a></sup>.</p>

<p>Another strategy is to log the fault register and stack values to 
persistent storage and periocially collect or push the error logs. On 
the server side, the register values can be decoded and addresses can be
 symbolicated to try to root cause the crash.</p>

<p>Alternatively, an end-to-end firmware error analysis system, such as
<a href="https://memfault.com/features/error-analysis.html?utm_source=interrupt&amp;utm_medium=link&amp;utm_campaign=cortex-m-faults" target="_blank">Memfault</a>,
can be used to automatically collect, transport, deduplicate and surface
 the faults and crashes happening in the field. Here is some example 
output from Memfault for the bad memory read example we will walk 
through <a href="#bad-address-read-example">below</a>:</p>

<p><img src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/memfault-fault-analyzer.png" alt=""></p>

<h2 id="recovering-from-a-fault">Recovering From A Fault<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#recovering-from-a-fault" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h2>

<blockquote>
  <p>DISCLAIMER: Typically when a fault occurs, the best thing to do is 
reset the MCU since it’s hard to be certain what parts of the MCU were 
corrupted as part of the fault (embedded MCUs don’t offer a MMU like you
 would find on a bigger processors).</p>
</blockquote>

<p>Occasionally, you may want to recover the system from a fault without
 rebooting it. For example, maybe you have one RTOS task isolated by the
 MPU that just needs to be restarted.</p>

<p>Let’s quickly explore how we could implement a recovery mechanism 
that puts a RTOS task which experience a UsageFault into an idle loop 
and reboots the system otherwise.</p>

<p>We will use the
<a href="https://interrupt.memfault.com/blog/arm-cortex-m-exceptions-and-nvic#application-interrupt-and-reset-control-register-aircr---0xe000ed0c">Application Interrupt and Reset Control Register</a> to reset the device if the fault is unrecoverable. We can easily extend <code class="highlighter-rouge">my_fault_handler_c</code> from <a href="#my-fault-handler-c">above</a>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">my_fault_handler_c</span><span class="p">(</span><span class="n">sContextStateFrame</span> <span class="o">*</span><span class="n">frame</span><span class="p">)</span> <span class="p">{</span>
<span class="p">[...]</span>
  <span class="k">volatile</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">cfsr</span> <span class="o">=</span> <span class="p">(</span><span class="k">volatile</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xE000ED28</span><span class="p">;</span>
  <span class="k">const</span> <span class="kt">uint32_t</span> <span class="n">usage_fault_mask</span> <span class="o">=</span> <span class="mh">0xffff0000</span><span class="p">;</span>
  <span class="k">const</span> <span class="n">bool</span> <span class="n">non_usage_fault_occurred</span> <span class="o">=</span>
      <span class="p">(</span><span class="o">*</span><span class="n">cfsr</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">usage_fault_mask</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// the bottom 8 bits of the xpsr hold the exception number of the</span>
  <span class="c1">// executing exception or 0 if the processor is in Thread mode</span>
  <span class="k">const</span> <span class="n">bool</span> <span class="n">faulted_from_exception</span> <span class="o">=</span> <span class="p">((</span><span class="n">frame</span><span class="o">-&gt;</span><span class="n">xpsr</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">faulted_from_exception</span> <span class="o">||</span> <span class="n">non_usage_fault_occurred</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// For any fault within an ISR or non-usage faults</span>
    <span class="c1">// let's reboot the system</span>
    <span class="k">volatile</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">aircr</span> <span class="o">=</span> <span class="p">(</span><span class="k">volatile</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xE000ED0C</span><span class="p">;</span>
    <span class="o">*</span><span class="n">aircr</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0x05FA</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="c1">// should be unreachable</span>
  <span class="p">}</span>
<span class="p">[...]</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now, the interesting part, how do we clean up our state and return to normal code from the HardFault handler?!</p>

<p>There’s a few things we will need to do:</p>

<ul>
  <li>Clear any logged faults from the <code class="highlighter-rouge">CFSR</code> by writing 1 to each bit which is set.</li>
  <li>Change the function we return to so we idle the task. In the example case it’s <code class="highlighter-rouge">recover_from_task_fault</code>.</li>
  <li>Scribble a known pattern over the <code class="highlighter-rouge">lr</code>. The function we are returning to will need to take special action (i.e like deleting the task or entering a <code class="highlighter-rouge">while(1)</code> loop). It can’t just exit and branch to where we were before so we <em>want</em> to fault if this is attempted.</li>
  <li>Reset the <code class="highlighter-rouge">xpsr</code>. Among other
 things the xpsr tracks the state of previous comparison instructions 
which were run and whether or not we are in the middle of a “If-Then” 
instruction block. The only bit that needs to remain set is the “T” 
field (bit 24) indicating the processor is in thumb mode<sup id="fnref:15"><a href="#fn:15" class="footnote">11</a></sup>.</li>
</ul>

<p>This winds up looking like:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">// Clear any logged faults from the CFSR</span>
  <span class="o">*</span><span class="n">cfsr</span> <span class="o">|=</span> <span class="o">*</span><span class="n">cfsr</span><span class="p">;</span>
  <span class="c1">// the instruction we will return to when we exit from the exception</span>
  <span class="n">frame</span><span class="o">-&gt;</span><span class="n">return_address</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">recover_from_task_fault</span><span class="p">;</span>
  <span class="c1">// the function we are returning to should never branch</span>
  <span class="c1">// so set lr to a pattern that would fault if it did</span>
  <span class="n">frame</span><span class="o">-&gt;</span><span class="n">lr</span> <span class="o">=</span> <span class="mh">0xdeadbeef</span><span class="p">;</span>
  <span class="c1">// reset the psr state and only leave the</span>
  <span class="c1">// "thumb instruction interworking" bit set</span>
  <span class="n">frame</span><span class="o">-&gt;</span><span class="n">xpsr</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">);</span>
</code></pre></div></div>

<p>You may recall from the
<a href="https://interrupt.memfault.com/blog/cortex-m-rtos-context-switching#context-state-stacking">RTOS Context Switching post</a>
that fault handlers can work just like regular C functions so after these changes we will exit from
<code class="highlighter-rouge">my_fault_handler_c</code> and start executing whatever is in <code class="highlighter-rouge">recover_from_task_fault</code> function. We will walk through an example of this <a href="#usage-fault-recovery-example">below</a>.</p>

<h2 id="examples">Examples<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#examples" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h2>

<p>In the sections below we will walk through the analysis of a couple faults.</p>

<p>For this setup we will use:</p>

<ul>
  <li>a nRF52840-DK<sup id="fnref:13"><a href="#fn:13" class="footnote">12</a></sup> (ARM Cortex-M4F) as our development board</li>
  <li>SEGGER JLinkGDBServer<sup id="fnref:12"><a href="#fn:12" class="footnote">13</a></sup> as our GDB Server.</li>
  <li>GCC 8.3.1 / GNU Arm Embedded Toolchain as our compiler<sup id="fnref:16"><a href="#fn:16" class="footnote">14</a></sup>
</li>
  <li>GNU make as our build system</li>
</ul>

<p>All the code can be found on the <a href="https://github.com/memfault/interrupt/tree/master/example/cortex-m-fault-debug" target="_blank">Interrupt Github page</a> with more details in the <code class="highlighter-rouge">README</code> in the directory linked.</p>

<h4 id="setup">Setup<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#setup" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<p>Start a GDB Server:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>JLinkGDBServer <span class="nt">-if</span> swd <span class="nt">-device</span> nRF52840_xxAA
</code></pre></div></div>

<p id="svd-usage-example">Follow the instructions <a href="#pycortex-svd-gdb-setup">above</a> to setup support for reading SVD files from GDB, build, and flash the example app:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>make
<span class="o">[</span>...]
Linking library
Generated build/nrf52.elf
<span class="nv">$ </span>arm-none-eabi-gdb-py <span class="nt">--eval-command</span><span class="o">=</span><span class="s2">"target remote localhost:2331"</span> <span class="nt">--ex</span><span class="o">=</span><span class="s2">"mon reset"</span> <span class="nt">--ex</span><span class="o">=</span><span class="s2">"load"</span> <span class="nt">--ex</span><span class="o">=</span><span class="s2">"mon reset"</span> <span class="nt">--se</span><span class="o">=</span>build/nrf52.elf
<span class="nv">$ </span><span class="nb">source </span>PyCortexMDebug/cmdebug/svd_gdb.py
<span class="nv">$ </span><span class="o">(</span>gdb<span class="o">)</span> svd_load cortex-m4-scb.svd
Loading SVD file cortex-m4-scb.svd...
<span class="o">(</span>gdb<span class="o">)</span>
</code></pre></div></div>

<p>The app has eight different crashes you can configure by changing <code class="highlighter-rouge">FAULT_EXAMPLE_CONFIG</code> at compile time or by editing the value at runtime:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) break main
(gdb) continue
(gdb) set g_crash_config=1
(gdb) continue
</code></pre></div></div>

<h3 id="bad-pc-mpu-fault">eXecute Never Fault<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#bad-pc-mpu-fault" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h3>

<h4 id="code">Code<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#code" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">illegal_instruction_execution</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">bad_instruction</span><span class="p">)(</span><span class="kt">void</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xE0000000</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">bad_instruction</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="analysis">Analysis<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#analysis" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) break main
(gdb) continue
Breakpoint 1, main () at ./cortex-m-fault-debug/main.c:180
180	  xQueue = xQueueCreate(mainQUEUE_LENGTH, sizeof(unsigned long));
(gdb) set g_crash_config=0
(gdb) c
Continuing.

Program received signal SIGTRAP, Trace/breakpoint trap.
0x00000218 in my_fault_handler_c (frame=0x200005e8 &lt;ucHeap+1152&gt;) at ./cortex-m-fault-debug/startup.c:91
91	  HALT_IF_DEBUGGING();
(gdb) bt
#0  0x00000218 in my_fault_handler_c (frame=0x200005e8 &lt;ucHeap+1152&gt;) at ./cortex-m-fault-debug/startup.c:91
#1  &lt;signal handler called&gt;
#2  0x00001468 in prvPortStartFirstTask () at ./cortex-m-fault-debug/freertos_kernel/portable/GCC/ARM_CM4F/port.c:267
#3  0x000016e6 in xPortStartScheduler () at ./cortex-m-fault-debug/freertos_kernel/portable/GCC/ARM_CM4F/port.c:379
#4  0x1058e476 in ?? ()
</code></pre></div></div>

<p>We can check the <code class="highlighter-rouge">CFSR</code> to see if there is any information about the fault which occurred.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) p/x *(uint32_t*)0xE000ED28
$3 = 0x1
(gdb) svd SCB CFSR_UFSR_BFSR_MMFSR
Fields in SCB CFSR_UFSR_BFSR_MMFSR:
	IACCVIOL:     1  Instruction access violation flag
[...]
</code></pre></div></div>

<p>That’s interesting! We hit a Memory Management instruction access 
violation fault even though we haven’t enabled any MPU regions. From the
 CFSR, we know that the stacked frame is valid so we can take a look at 
that to see what it reveals:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) p/a *frame
$1 = {
  r0 = 0x0 &lt;g_pfnVectors&gt;,
  r1 = 0x200003c4 &lt;ucHeap+604&gt;,
  r2 = 0x10000000,
  r3 = 0xe0000000,
  r12 = 0x200001b8 &lt;ucHeap+80&gt;,
  lr = 0x195 &lt;prvQueuePingTask+52&gt;,
  return_address = 0xe0000000,
  xpsr = 0x80000000
}
</code></pre></div></div>

<p>We can clearly see that the executing instruction was <code class="highlighter-rouge">0xe0000000</code> and that the calling function was <code class="highlighter-rouge">prvQueuePingTask</code>.</p>

<p>From the ARMv7-M reference manual<sup id="fnref:9"><a href="#fn:9" class="footnote">15</a></sup> we find:</p>

<blockquote>
  <p>The MPU is restricted in how it can change the default memory map 
attributes associated with System space, that is, for addresses 
0xE0000000 and higher. System space is always marked as XN, Execute 
Never.</p>
</blockquote>

<p>So the fault registers didn’t lie to us, and it does make sense that we hit a memory management fault!</p>

<h3 id="bad-address-read-example">Bad Address Read<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#bad-address-read-example" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h3>

<h4 id="code-1">Code<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#code-1" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">uint32_t</span> <span class="nf">read_from_bad_address</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xbadcafe</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="analysis-1">Analysis<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#analysis-1" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) break main
(gdb) continue
Breakpoint 1, main () at ./cortex-m-fault-debug/main.c:189
189	  xQueue = xQueueCreate(mainQUEUE_LENGTH, sizeof(unsigned long));
(gdb) set g_crash_config=1
(gdb) c
Continuing.

Program received signal SIGTRAP, Trace/breakpoint trap.
0x00000218 in my_fault_handler_c (frame=0x200005e8 &lt;ucHeap+1152&gt;) at ./cortex-m-fault-debug/startup.c:91
91	  HALT_IF_DEBUGGING();
</code></pre></div></div>

<p>Again, let’s take a look at the <code class="highlighter-rouge">CFSR</code> and see if it tells us anything useful.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) p/x *(uint32_t*)0xE000ED28
$13 = 0x8200
(gdb) svd SCB CFSR_UFSR_BFSR_MMFSR
Fields in SCB CFSR_UFSR_BFSR_MMFSR:
[...]
    PRECISERR:    1  Precise data bus error
[...]
    BFARVALID:    1  Bus Fault Address Register (BFAR) valid flag
</code></pre></div></div>

<p>Great, we have a precise bus fault which means the return address in 
the stack frame holds the instruction which triggered the fault and that
 we can read BFAR to determine what memory access triggered the fault!</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) svd/x SCB BFAR
Fields in SCB BFAR:
	BFAR:  0x0BADCAFE  Bus fault address

(gdb) p/a *frame
$16 = {
  r0 = 0x1 &lt;g_pfnVectors+1&gt;,
  r1 = 0x200003c4 &lt;ucHeap+604&gt;,
  r2 = 0x10000000,
  r3 = 0xbadcafe,
  r12 = 0x200001b8 &lt;ucHeap+80&gt;,
  lr = 0x195 &lt;prvQueuePingTask+52&gt;,
  return_address = 0x13a &lt;trigger_crash+22&gt;,
  xpsr = 0x81000000
}

(gdb) info line *0x13a
Line 123 of "./cortex-m-fault-debug/main.c" starts at address 0x138 &lt;trigger_crash+20&gt; and ends at 0x13e &lt;trigger_crash+26&gt;.

(gdb) list *0x13a
0x13a is in trigger_crash (./cortex-m-fault-debug/main.c:123).
118	  switch (crash_id) {
119	    case 0:
120	      illegal_instruction_execution();
121	      break;
122	    case 1:
===&gt; FAULT HERE
123	      read_from_bad_address();
124	      break;
125	    case 2:
126	      access_disabled_coprocessor();
127	      break;
</code></pre></div></div>

<p>Great, so we have pinpointed the exact code which triggered the issue and can now fix it!</p>

<h3 id="coprocessor-fault-example">Coprocessor Fault<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#coprocessor-fault-example" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h3>

<h4 id="code-2">Code<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#code-2" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">access_disabled_coprocessor</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// FreeRTOS will automatically enable the FPU co-processor.</span>
  <span class="c1">// Let's disable it for the purposes of this example</span>
  <span class="kr">__asm</span> <span class="k">volatile</span><span class="p">(</span>
      <span class="s">"ldr r0, =0xE000ED88 </span><span class="se">\n</span><span class="s">"</span>
      <span class="s">"mov r1, #0 </span><span class="se">\n</span><span class="s">"</span>
      <span class="s">"str r1, [r0]	</span><span class="se">\n</span><span class="s">"</span>
      <span class="s">"dsb </span><span class="se">\n</span><span class="s">"</span>
      <span class="s">"vmov r0, s0 </span><span class="se">\n</span><span class="s">"</span>
      <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="analysis-2">Analysis<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#analysis-2" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) break main
(gdb) continue
Breakpoint 4, main () at ./cortex-m-fault-debug/main.c:180
180	  xQueue = xQueueCreate(mainQUEUE_LENGTH, sizeof(unsigned long));
(gdb) set g_crash_config=2
(gdb) c
Continuing.

Program received signal SIGTRAP, Trace/breakpoint trap.
0x00000218 in my_fault_handler_c (frame=0x20002d80) at ./cortex-m-fault-debug/startup.c:91
91	  HALT_IF_DEBUGGING();
</code></pre></div></div>

<p>We can inspect <code class="highlighter-rouge">CFSR</code> to get a clue about the crash which took place</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) p/x *(uint32_t*)0xE000ED28
$13 = 0x8200
(gdb) svd SCB CFSR_UFSR_BFSR_MMFSR
Fields in SCB CFSR_UFSR_BFSR_MMFSR:
[...]
	NOCP:         1  No coprocessor usage fault.
[...]
</code></pre></div></div>

<p>We see it was a coprocessor UsageFault which tells us we either 
issued an instruction to a non-existent or disabled Cortex-M 
coprocessor. We know the frame contents are valid so we can inspect that
 to figure out where the fault originated:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) p/a *frame
$27 = {
  r0 = 0xe000ed88,
  r1 = 0x0 &lt;g_pfnVectors&gt;,
  r2 = 0x10000000,
  r3 = 0x0 &lt;g_pfnVectors&gt;,
  r12 = 0x200001b8 &lt;ucHeap+80&gt;,
  lr = 0x199 &lt;prvQueuePingTask+52&gt;,
  return_address = 0x114 &lt;access_disabled_coprocessor+12&gt;,
  xpsr = 0x81000000
}

(gdb) disassemble 0x114
Dump of assembler code for function access_disabled_coprocessor:
   0x00000108 &lt;+0&gt;:	ldr	r0, [pc, #16]	; (0x11c)
   0x0000010a &lt;+2&gt;:	mov.w	r1, #0
   0x0000010e &lt;+6&gt;:	str	r1, [r0, #0]
   0x00000110 &lt;+8&gt;:	dsb	sy
===&gt; FAULT HERE on a Floating Point instruction
   0x00000114 &lt;+12&gt;:	vmov	r0, s0
   0x00000118 &lt;+16&gt;:	bx	lr
</code></pre></div></div>

<p><code class="highlighter-rouge">vmov</code> is a floating point 
instruction so we now know what coprocessor the NOCP was caused by. The 
FPU is enabled using bits 20-23 of the <a href="https://interrupt.memfault.com/blog/cortex-m-rtos-context-switching#fpu-config-options">CPACR</a> register located at <code class="highlighter-rouge">0xE000ED88</code>. A value of 0 indicates the extension is disabled. Let’s check it:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) p/x (*(uint32_t*)0xE000ED88 &gt;&gt; 20) &amp; 0xf
$29 = 0x0
</code></pre></div></div>

<p>We can clearly see the FP Extension is disabled. We will have to enable the FPU to fix our bug.</p>

<h3 id="imprecise-error-code-example">Imprecise Fault<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#imprecise-error-code-example" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h3>

<h4 id="code-3">Code<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#code-3" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">bad_addr_double_word_write</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">volatile</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="p">(</span><span class="k">volatile</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x30000000</span><span class="p">;</span>
  <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="mh">0x1122334455667788</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="analysis-3">Analysis<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#analysis-3" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) break main
(gdb) continue
Breakpoint 4, main () at ./cortex-m-fault-debug/main.c:182
182	  xQueue = xQueueCreate(mainQUEUE_LENGTH, sizeof(unsigned long));
(gdb) set g_crash_config=3
(gdb) c
Continuing.

Program received signal SIGTRAP, Trace/breakpoint trap.
0x0000021c in my_fault_handler_c (frame=0x200005e8 &lt;ucHeap+1152&gt;) at ./cortex-m-fault-debug/startup.c:91
91	  HALT_IF_DEBUGGING();
</code></pre></div></div>

<p>Let’s inspect <code class="highlighter-rouge">CFSR</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) p/x *(uint32_t*)0xE000ED28
$31 = 0x400
(gdb) svd SCB CFSR_UFSR_BFSR_MMFSR
Fields in SCB CFSR_UFSR_BFSR_MMFSR:
[...]
	IMPRECISERR:  1  Imprecise data bus error
[...]
</code></pre></div></div>

<p>Yikes, the error is imprecise. This means the stack frame will point to the general area where the fault occurred but <strong>not</strong> the exact instruction!</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) p/a *frame
$32 = {
  r0 = 0x55667788,
  r1 = 0x11223344,
  r2 = 0x10000000,
  r3 = 0x30000000,
  r12 = 0x200001b8 &lt;ucHeap+80&gt;,
  lr = 0x199 &lt;prvQueuePingTask+52&gt;,
  return_address = 0x198 &lt;prvQueuePingTask+52&gt;,
  xpsr = 0x81000000
}
(gdb) list *0x198
0x198 is in prvQueuePingTask (./cortex-m-fault-debug/main.c:162).
157
158	  while (1) {
159	    vTaskDelayUntil(&amp;xNextWakeTime, mainQUEUE_SEND_FREQUENCY_MS);
160	    xQueueSend(xQueue, &amp;ulValueToSend, 0U);
161
==&gt; Crash somewhere around here
162	    trigger_crash(g_crash_config);
163	  }
164	}
165
166	static void prvQueuePongTask(void *pvParameters) {
</code></pre></div></div>

<h4 id="analysis-after-making-the-imprecise-error-precise">Analysis after making the Imprecise Error Precise<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#analysis-after-making-the-imprecise-error-precise" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<p>If the crash was not readily reproducible we would have to inspect 
the code around this region and hypothesize what looks suspicious. 
However, <a href="#cortex-m3-m4-debug-trick">recall</a> that there is a trick we can use for the Cortex-M4 to make all memory stores precise. Let’s enable that and re-examine:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) mon reset
Resetting target
(gdb) c
Continuing.

Breakpoint 4, main () at ./cortex-m-fault-debug/main.c:182
182	  xQueue = xQueueCreate(mainQUEUE_LENGTH, sizeof(unsigned long));
(gdb) set g_crash_config=3

==&gt; Make all memory stores precise at the cost of performance
==&gt; by setting DISDEFWBUF in the Cortex M3/M4 ACTLR reg
(gdb) set *(uint32_t*)0xE000E008=(*(uint32_t*)0xE000E008 | 1&lt;&lt;1)

(gdb) c
Continuing.

Program received signal SIGTRAP, Trace/breakpoint trap.
0x0000021c in my_fault_handler_c (frame=0x200005e8 &lt;ucHeap+1152&gt;) at ./cortex-m-fault-debug/startup.c:91
91	  HALT_IF_DEBUGGING();
(gdb) p/a *frame
$33 = {
  r0 = 0x55667788,
  r1 = 0x11223344,
  r2 = 0x10000000,
  r3 = 0x30000000,
  r12 = 0x200001b8 &lt;ucHeap+80&gt;,
  lr = 0x199 &lt;prvQueuePingTask+52&gt;,
  return_address = 0xfa &lt;bad_addr_double_word_write+10&gt;,
  xpsr = 0x81000000
}
(gdb) list *0xfa
0xfa is in bad_addr_double_word_write (./cortex-m-fault-debug/main.c:92).
90	void bad_addr_double_word_write(void) {
91	  volatile uint64_t *buf = (volatile uint64_t *)0x30000000;
==&gt; FAULT HERE
92	  *buf = 0x1122334455667788;
93	}
(gdb)
</code></pre></div></div>

<p>Awesome, that saved us some time … we were able to determine the exact line that caused the crash!</p>

<h3 id="stkerr-example">Fault Entry Exception<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#stkerr-example" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h3>

<h4 id="code-4">Code<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#code-4" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">stkerr_from_psp</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">extern</span> <span class="kt">uint32_t</span> <span class="n">_start_of_ram</span><span class="p">[];</span>
  <span class="kt">uint8_t</span> <span class="n">dummy_variable</span><span class="p">;</span>
  <span class="k">const</span> <span class="kt">size_t</span> <span class="n">distance_to_ram_bottom</span> <span class="o">=</span>
      <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="o">&amp;</span><span class="n">dummy_variable</span> <span class="o">-</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">_start_of_ram</span><span class="p">;</span>
  <span class="k">volatile</span> <span class="kt">uint8_t</span> <span class="n">big_buf</span><span class="p">[</span><span class="n">distance_to_ram_bottom</span> <span class="o">-</span> <span class="mi">8</span><span class="p">];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">big_buf</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">big_buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">trigger_irq</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="analysis-4">Analysis<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#analysis-4" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) break main
(gdb) continue
Breakpoint 4, main () at ./cortex-m-fault-debug/main.c:182
182	  xQueue = xQueueCreate(mainQUEUE_LENGTH, sizeof(unsigned long));
(gdb) set g_crash_config=4
(gdb) c
Continuing.

Program received signal SIGTRAP, Trace/breakpoint trap.
0x0000021c in my_fault_handler_c (frame=0x1fffffe0) at ./cortex-m-fault-debug/startup.c:91
91	  HALT_IF_DEBUGGING();
</code></pre></div></div>

<p>Let’s take a look at <code class="highlighter-rouge">CFSR</code> again to get a clue about what happened:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) p/x *(uint32_t*)0xE000ED28
$39 = 0x1000
(gdb) svd SCB CFSR_UFSR_BFSR_MMFSR
Fields in SCB CFSR_UFSR_BFSR_MMFSR:
[...]
	STKERR:       1  Bus fault on stacking for exception entry
</code></pre></div></div>

<h4 id="debug-tips-when-dealing-with-a-stkerr">Debug Tips when dealing with a STKERR<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#debug-tips-when-dealing-with-a-stkerr" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<p>There are two really important things to note when a stacking exception occurs:</p>

<ol>
  <li>The stack pointer will always reflect the correct adjusted 
position as if the hardware successfully stacked the registers. This 
means you can find the stack pointer prior to exception entry by adding 
the adjustment value.</li>
  <li>Depending on what access triggers the exception, the stacked frame
 may be partially valid. For example, the very last store of the 
hardware stacking could trigger the fault and all the other stores could
 be valid. However, the <strong>order</strong> the hardware pushes register state on the stack is <strong>implementation specific</strong>. So when inspecting the frame assume the values being looked at may be invalid!</li>
</ol>

<p>Taking this knowledge into account, let’s examine the stack frame:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) p frame
$40 = (sContextStateFrame *) 0x1fffffe0
</code></pre></div></div>

<p>Interestingly, if we look up the memory map of the NRF52<sup id="fnref:10"><a href="#fn:10" class="footnote">16</a></sup>, we will find that RAM starts at <code class="highlighter-rouge">0x20000000</code>. Our stack pointer location, <code class="highlighter-rouge">0x1fffffe0</code>
 is right below that in an undefined memory region. This must be why we 
faulted! We see that the stack pointer is 32 bytes below RAM, which 
matches the size of <code class="highlighter-rouge">sContextStateFrame</code>.
 This unfortunately means none of the values stacked will be valid since
 all stores were issued to a non-existent address space!</p>

<p>We can manually walk up the stack to get some clues:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) x/a 0x20000000
0x20000000 &lt;uxCriticalNesting&gt;:	0x3020100
(gdb)
0x20000004 &lt;g_crash_config&gt;:	0x7060504
(gdb)
0x20000008 &lt;xQueue&gt;:	0xb0a0908
(gdb)
0x2000000c &lt;s_buffer&gt;:	0xf0e0d0c
(gdb)
0x20000010 &lt;s_buffer+4&gt;:	0x13121110
(gdb)
0x20000014 &lt;s_buffer+8&gt;:	0x17161514
(gdb)
0x20000018 &lt;pxCurrentTCB&gt;:	0x1b1a1918
(gdb)
0x2000001c &lt;pxDelayedTaskList&gt;:	0x1f1e1d1c
(gdb)
0x20000020 &lt;pxOverflowDelayedTaskList&gt;:	0x23222120
</code></pre></div></div>

<p>It looks like the RAM has a pattern of sequentially increasing values <em>and</em> that the RAM addresses map to different variables in our code (i.e <code class="highlighter-rouge">pxCurrentTCB</code>). This suggests we overflowed the stack we were using and started to clobber RAM in the system until we ran off the end of RAM!</p>

<blockquote>
  <p>TIP: To catch this type of failure sooner consider using an <a href="https://interrupt.memfault.com/blog/fix-bugs-and-secure-firmware-with-the-mpu#catch-stack-overflows-with-the-mpu">MPU Region</a></p>
</blockquote>

<p>Since the crash is reproducible, let’s leverage a watchpoint and see 
if we can capture the stack corruption in action! Let’s add a watchpoint
 for any access near the bottom of RAM, <code class="highlighter-rouge">0x2000000c</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) mon reset
(gdb) continue
Breakpoint 4, main () at ./cortex-m-fault-debug/main.c:182
182	  xQueue = xQueueCreate(mainQUEUE_LENGTH, sizeof(unsigned long));
(gdb) set g_crash_config=4
(gdb) watch *(uint32_t*)0x2000000c
Hardware watchpoint 9: *(uint32_t*)0x2000000c
</code></pre></div></div>

<blockquote>
  <p>TIP: Sometimes it will take a couple tries to choose the right RAM 
range to watch. It’s possible an area of the stack never gets written to
 and the watchpoint never fires or that the memory address being watched
 gets updated many many times before the actual failure. In this 
example, I intentionally opted not to watch 0x20000000 because that is 
the address of a FreeRTOS variable, <code class="highlighter-rouge">uxCriticalNesting</code> which is updated a lot.</p>
</blockquote>

<p>Let’s continue and see what happens:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) continue
Hardware watchpoint 9: *(uint32_t*)0x2000000c

Old value = 0
New value = 12
0x000000c0 in stkerr_from_psp () at ./cortex-m-fault-debug/main.c:68
68	    big_buf[i] = i;
(gdb) bt
#0  0x000000c0 in stkerr_from_psp () at ./cortex-m-fault-debug/main.c:68
#1  0x00000198 in prvQueuePingTask (pvParameters=&lt;optimized out&gt;) at ./cortex-m-fault-debug/main.c:162
#2  0x00001488 in ?? () at ./cortex-m-fault-debug/freertos_kernel/portable/GCC/ARM_CM4F/port.c:703
Backtrace stopped: previous frame identical to this frame (corrupt stack?)
(gdb) list *0xc0
0xc0 is in stkerr_from_psp (./cortex-m-fault-debug/main.c:68).
63	  extern uint32_t _start_of_ram[];
64	  uint8_t dummy_variable;
65	  const size_t distance_to_ram_bottom = (uint32_t)&amp;dummy_variable - (uint32_t)_start_of_ram;
66	  volatile uint8_t big_buf[distance_to_ram_bottom - 8];
67	  for (size_t i = 0; i &lt; sizeof(big_buf); i++) {
68	    big_buf[i] = i;
69	  }
70
71	  trigger_irq();
72	}
</code></pre></div></div>

<p>Great, we’ve found a variable located on the stack <code class="highlighter-rouge">big_buf</code>
 being updated. It must be this function call path which is leading to a
 stack overflow. We can now inspect the call chain and remove big stack 
allocations!</p>

<h3 id="usage-fault-recovery-example">Recovering from a UsageFault <strong>without</strong> a SYSRESET<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#usage-fault-recovery-example" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h3>

<p>In this example we’ll just step through the code we developed <a href="#recovering-from-a-fault">above</a> and confirm we don’t reset when a UsageFault occurs.</p>

<h4 id="code-5">Code<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#code-5" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">unaligned_double_word_read</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">extern</span> <span class="kt">void</span> <span class="o">*</span><span class="n">g_unaligned_buffer</span><span class="p">;</span>
  <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="n">g_unaligned_buffer</span><span class="p">;</span>
  <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="mh">0x1122334455667788</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="analysis-5">Analysis<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#analysis-5" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) break main
(gdb) continue
Breakpoint 4, main () at ./cortex-m-fault-debug/main.c:188
188	  xQueue = xQueueCreate(mainQUEUE_LENGTH, sizeof(unsigned long));
(gdb) set g_crash_config=5
(gdb) c
Continuing.

Program received signal SIGTRAP, Trace/breakpoint trap.
0x00000228 in my_fault_handler_c (frame=0x200005e8 &lt;ucHeap+1152&gt;) at ./cortex-m-fault-debug/startup.c:94
94	  HALT_IF_DEBUGGING();
</code></pre></div></div>

<p>We have entered the breakpoint in the fault handler. We can step over it and confirm we fall through to the <code class="highlighter-rouge">recover_from_task_fault</code> function.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gdb) break recover_from_task_fault
Breakpoint 12 at 0x1a8: file ./cortex-m-fault-debug/main.c, line 181.
(gdb) n
108	  volatile uint32_t *cfsr = (volatile uint32_t *)0xE000ED28;
(gdb) c
Continuing.

Breakpoint 12, recover_from_task_fault () at ./cortex-m-fault-debug/main.c:181
181	void recover_from_task_fault(void) {

(gdb) list *recover_from_task_fault
0x1a8 is in recover_from_task_fault (./cortex-m-fault-debug/main.c:181).
181	void recover_from_task_fault(void) {
182	  while (1) {
183	    vTaskDelay(1);
184	  }
185	}
</code></pre></div></div>

<p>If we continue from here we will see the system happily keeps running because the thread which was calling the problematic <code class="highlighter-rouge">trigger_crash</code>
 function is now parked in a while loop. The the while loop could be 
extended in the future to delete and/or restart the FreeRTOS task if we 
wanted as well.</p>

<h2 class="no_toc" id="closing">Closing<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#closing" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h2>

<p>I hope this post gave you a useful overview of how to debug a 
HardFault on a Cortex-M MCU and that maybe you even learned something 
new!</p>

<p>Are there tricks you like to use that I didn’t mention or other topics about faults you’d like to learn more about?
Let us know in the discussion area below!</p>

<div class="submit-pr">
  <p class="submit-pr-content">See anything you'd like to change? Submit a pull request or open an issue at <a class="submit-pr-link" href="https://github.com/memfault/interrupt" target="_blank">GitHub</a></p>
</div>

<h2 class="no_toc" id="references">References<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#references" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h2>

<div class="footnotes">
  <ol>
    <li id="fn:14">
      <p><a href="https://eng.fitbit.com/the-tower-of-terror-a-bug-mystery/" target="_blank">The Tower of Terror: A Bug Mystery</a>&nbsp;<a href="#fnref:14" class="reversefootnote">↩</a>&nbsp;<a href="#fnref:14:1" class="reversefootnote">↩<sup>2</sup></a></p>
    </li>
    <li id="fn:1">
      <p><a href="https://static.docs.arm.com/ddi0403/eb/DDI0403E_B_armv7m_arm.pdf" target="_blank">See “A4.1.1 ARMv7-M and interworking support”</a>&nbsp;<a href="#fnref:1" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:8">
      <p><a href="https://www.segger.com/products/debug-probes/j-trace/" target="_blank">Segger JTrace</a> &amp; <a href="https://www.lauterbach.com/frames.html?home.htmlLink%20lauterbach" target="_blank">Lauterbach Trace32</a> are both capable of analyzing the ETM&nbsp;<a href="#fnref:8" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:7">
      <p><a href="http://infocenter.arm.com/help/topic/com.arm.doc.ddi0489b/DDI0489B_cortex_m7_trm.pdf" target="_blank">See “3.3.9 Auxiliary Bus Fault Status Register”</a>&nbsp;<a href="#fnref:7" class="reversefootnote">↩</a>&nbsp;<a href="#fnref:7:1" class="reversefootnote">↩<sup>2</sup></a></p>
    </li>
    <li id="fn:11">
      <p><a href="https://infocenter.nordicsemi.com/pdf/nRF52840_PS_v1.0.pdf" target="_blank">See “5.3.6.8 Reset behavior”</a>&nbsp;<a href="#fnref:11" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:2">
      <p><a href="https://github.com/ARMmbed/mbed-os/blob/2e96145b7607de430235dd795ab5350c1d4d64d7/platform/source/TARGET_CORTEX_M/mbed_fault_handler.c#L44-L81" target="_blank">MBed OS fault handler</a>&nbsp;<a href="#fnref:2" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:3">
      <p><a href="https://github.com/intel/zephyr/blob/e09a04f0689fd29aa909cc49ee94fd129798f986/arch/arm/core/fault.c#L55-L275" target="_blank">Zephyr ARM fault handler</a>&nbsp;<a href="#fnref:3" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:4">
      <p><a href="https://arm-software.github.io/CMSIS_5/SVD/html/index.html" target="_blank">CMSIS-SVD</a>&nbsp;<a href="#fnref:4" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:5">
      <p><a href="https://developer.arm.com/tools-and-software/embedded/cmsis" target="_blank">CMSIS Software Packs</a>&nbsp;<a href="#fnref:5" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:6">
      <p><a href="https://github.com/bnahill/PyCortexMDebug" target="_blank">PyCortexMDebug</a>&nbsp;<a href="#fnref:6" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:15">
      <p><a href="https://static.docs.arm.com/ddi0403/eb/DDI0403E_B_armv7m_arm.pdf" target="_blank">See “B1.5.5 Reset behavior” &amp; “B1.4.2 The special-purpose program status registers, xPSR”</a>&nbsp;<a href="#fnref:15" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:13">
      <p><a href="https://www.nordicsemi.com/Software-and-Tools/Development-Kits/nRF52840-DK" target="_blank">nRF52840 Development Kit</a>&nbsp;<a href="#fnref:13" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:12">
      <p><a href="https://www.segger.com/products/debug-probes/j-link/tools/j-link-gdb-server/about-j-link-gdb-server/" target="_blank">JLinkGDBServer</a>&nbsp;<a href="#fnref:12" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:16">
      <p><a href="https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads" target="_blank">GNU ARM Embedded toolchain for download</a>&nbsp;<a href="#fnref:16" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:9">
      <p><a href="https://static.docs.arm.com/ddi0403/eb/DDI0403E_B_armv7m_arm.pdf" target="_blank">See B3.5.1 “Relation of the MPU to the system memory map”</a>&nbsp;<a href="#fnref:9" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:10">
      <p><a href="https://infocenter.nordicsemi.com/pdf/nRF52840_PS_v1.0.pdf" target="_blank">See “4.2.3 Memory map”</a>&nbsp;<a href="#fnref:10" class="reversefootnote">↩</a></p>
    </li>
  </ol>
</div>


    </div>

    
        <div class="author">
            
            <img src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/chris.jpg">
            
            <span>
                <a href="https://interrupt.memfault.com/blog/authors/chris">Chris Coleman</a>
 is a founder and CTO at Memfault. Prior to founding Memfault, Chris 
worked on the embedded software teams at Sun, Pebble, and Fitbit.<br>
                
<span>
    
    
    <a href="https://www.linkedin.com/in/christopher-coleman-812aa06b/" target="_blank"><svg class="svg-icon linkedin"><use xlink:href="/blog/img/social-icons.svg#linkedin"></use></svg></a>
    
    
    <a href="https://github.com/chrisc11" target="_blank"><svg class="svg-icon github"><use xlink:href="/blog/img/social-icons.svg#github"></use></svg></a>
    
</span>

            </span>

        </div>
    

    <div id="discourse-comments"><iframe src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/comments.htm" id="discourse-embed-frame" scrolling="no" referrerpolicy="no-referrer-when-downgrade" width="100%" height="3991px" frameborder="0"></iframe></div>
</article>
<script type="text/javascript">
    DiscourseEmbed = { discourseUrl: 'https://community.memfault.com/',
        discourseEmbedUrl: 'https://interrupt.memfault.com/blog/cortex-m-fault-debug' };

    (function() {
        var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
        d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
    })();
    anchors.options.visible = 'hover';
    anchors.add('.post-content > h1, h2, h3, h4, h5, h6');
</script>



        </main>
        <aside>
          <!-- HTML elements for search -->
<form id="search-form">
  <label for="search-input">
    <h3>Search</h3>
  </label>
  <input type="text" id="search-input" placeholder="Search posts..">
</form>
<ul id="results-container"></ul>

<!-- or without installing anything -->
<script src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/simple-jekyll-search.js"></script>

<script>
  window.simpleJekyllSearch = new SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('results-container'),
    json: '/blog/search.json',
    searchResultTemplate: '<li><a href="{url}?query={query}" title="{title}">{title}</a></li>',
    noResultsText: 'No results found',
    limit: 10,
    fuzzy: false
  })
</script>

          <!--[if lte IE 8]>

<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script>
<![endif]-->

<script charset="utf-8" type="text/javascript" src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/v2.js"></script>
<script data-hubspot-rendered="true"> hbspt.forms.create({ portalId: "8551838", formId: "a61bb5a0-4339-4398-b639-c0894f961532" });
</script><div class="hbspt-form" id="hbspt-form-1613481475559-5669134384"><form novalidate="" accept-charset="UTF-8" action="https://forms.hsforms.com/submissions/v3/public/submit/formsnext/multipart/8551838/a61bb5a0-4339-4398-b639-c0894f961532" enctype="multipart/form-data" id="hsForm_a61bb5a0-4339-4398-b639-c0894f961532" method="POST" class=" hs-form hs-form-private hsForm_a61bb5a0-4339-4398-b639-c0894f961532 hs-form-a61bb5a0-4339-4398-b639-c0894f961532 hs-form-a61bb5a0-4339-4398-b639-c0894f961532_6bab7fee-d0a3-4292-830f-0c2104677c68" data-form-id="a61bb5a0-4339-4398-b639-c0894f961532" data-portal-id="8551838" target="target_iframe_a61bb5a0-4339-4398-b639-c0894f961532" data-reactid=".hbspt-forms-0"><div data-reactid=".hbspt-forms-0.1:$0"><div class="hs-richtext hs-main-font-element" data-reactid=".hbspt-forms-0.1:$0.0"><h3 style="font-size: 24px;"><strong>Subscribe</strong></h3>
<p><strong>Enter your email below to receive new Interrupt posts straight to your mailbox.</strong></p></div></div><div class="hs_email hs-email hs-fieldtype-text field hs-form-field" data-reactid=".hbspt-forms-0.1:$1"><label id="label-email-a61bb5a0-4339-4398-b639-c0894f961532" class="" placeholder="Enter your Email" for="email-a61bb5a0-4339-4398-b639-c0894f961532" data-reactid=".hbspt-forms-0.1:$1.0"><span data-reactid=".hbspt-forms-0.1:$1.0.0">Email</span><span class="hs-form-required" data-reactid=".hbspt-forms-0.1:$1.0.1">*</span></label><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.1:$1.1"></legend><div class="input" data-reactid=".hbspt-forms-0.1:$1.$email"><input id="email-a61bb5a0-4339-4398-b639-c0894f961532" class="hs-input" type="email" name="email" required="" placeholder="" autocomplete="email" data-reactid=".hbspt-forms-0.1:$1.$email.0" inputmode="email"></div></div><div class="hs_interrupt_blog_subscription_status hs-interrupt_blog_subscription_status hs-fieldtype-booleancheckbox field hs-form-field" style="display:none;" data-reactid=".hbspt-forms-0.1:$2"><legend class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.1:$2.1"></legend><div class="input" data-reactid=".hbspt-forms-0.1:$2.$interrupt_blog_subscription_status"><input name="interrupt_blog_subscription_status" class="hs-input" type="hidden" value="true" data-reactid=".hbspt-forms-0.1:$2.$interrupt_blog_subscription_status.0"></div></div><noscript data-reactid=".hbspt-forms-0.2"></noscript><div class="hs_submit hs-submit" data-reactid=".hbspt-forms-0.5"><div class="hs-field-desc" style="display:none;" data-reactid=".hbspt-forms-0.5.0"></div><div class="actions" data-reactid=".hbspt-forms-0.5.1"><input type="submit" value="Subscribe" class="hs-button primary large" data-reactid=".hbspt-forms-0.5.1.0"></div></div><noscript data-reactid=".hbspt-forms-0.6"></noscript><input name="hs_context" type="hidden" value="{&quot;rumScriptExecuteTime&quot;:4565,&quot;rumServiceResponseTime&quot;:6482,&quot;rumFormRenderTime&quot;:2,&quot;rumTotalRenderTime&quot;:6484,&quot;rumTotalRequestTime&quot;:1916,&quot;lang&quot;:&quot;en&quot;,&quot;embedType&quot;:&quot;SHARABLE&quot;,&quot;renderRawHtml&quot;:&quot;true&quot;,&quot;embedAtTimestamp&quot;:&quot;1613481477982&quot;,&quot;formDefinitionUpdatedAt&quot;:&quot;1607020009431&quot;,&quot;pageUrl&quot;:&quot;https://interrupt.memfault.com/blog/cortex-m-fault-debug&quot;,&quot;pageTitle&quot;:&quot;How to debug a HardFault on an ARM Cortex-M MCU | Interrupt&quot;,&quot;source&quot;:&quot;FormsNext-static&quot;,&quot;timestamp&quot;:1613481477982,&quot;userAgent&quot;:&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:85.0) Gecko/20100101 Firefox/85.0&quot;,&quot;referrer&quot;:&quot;https://www.google.com/&quot;,&quot;originalEmbedContext&quot;:{&quot;portalId&quot;:&quot;8551838&quot;,&quot;formId&quot;:&quot;a61bb5a0-4339-4398-b639-c0894f961532&quot;,&quot;target&quot;:&quot;#hbspt-form-1613481475559-5669134384&quot;},&quot;boolCheckBoxFields&quot;:&quot;interrupt_blog_subscription_status&quot;,&quot;formTarget&quot;:&quot;#hbspt-form-1613481475559-5669134384&quot;,&quot;correlationId&quot;:&quot;d5a4504b-ee07-475d-be1a-e3486d1980c3&quot;,&quot;hutk&quot;:&quot;b4b6bee2ad17f4b859bf2efdb0b9eda9&quot;,&quot;useRecaptchaEnterprise&quot;:true}" data-reactid=".hbspt-forms-0.7"><iframe name="target_iframe_a61bb5a0-4339-4398-b639-c0894f961532" style="display:none;" data-reactid=".hbspt-forms-0.8"></iframe></form></div>
          



<div class="share-buttons-wrapper">
    <h3>Share on: </h3>
    <div id="share-buttons">
        <div class="facebook" title="Share this on Facebook" onclick="window.open(`http://www.facebook.com/share.php?u=https://interrupt.memfault.com/blog/cortex-m-fault-debug`);">
            <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
                <path fill="inherit" d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"></path>
            </svg>
        </div>

        <div class="twitter" title="Share this on Twitter" onclick="window.open(`https://twitter.com/share?url=https://interrupt.memfault.com/blog/cortex-m-fault-debug&amp;text=How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU`);">
            <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
                <path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"></path>
            </svg>
        </div>

        <div class="linkedin" title="Share this on Linkedin" onclick="window.open(`https://www.linkedin.com/shareArticle?mini=true&amp;url=https://interrupt.memfault.com/blog/cortex-m-fault-debug&amp;title=How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU&amp;summary=&amp;source=https://interrupt.memfault.com/blog/cortex-m-fault-debug`);">
            <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
                <path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"></path>
            </svg>
        </div>

        <div class="reddit" title="Share this on Reddit" onclick="window.open(`http://www.reddit.com/submit?url=https://interrupt.memfault.com/blog/cortex-m-fault-debug&amp;title=How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU&amp;summary=&amp;source=`, 'newwindow');">
            <svg id="Bold" enable-background="new 0 0 24 24" height="512" viewBox="0 0 24 24" width="512" xmlns="http://www.w3.org/2000/svg">
                <path d="m21.325 9.308c-.758 0-1.425.319-1.916.816-1.805-1.268-4.239-2.084-6.936-2.171l1.401-6.406 4.461 1.016c0 1.108.89 2.013 1.982 2.013 1.113 0 2.008-.929 2.008-2.038s-.889-2.038-2.007-2.038c-.779 0-1.451.477-1.786 1.129l-4.927-1.108c-.248-.067-.491.113-.557.365l-1.538 7.062c-2.676.113-5.084.928-6.895 2.197-.491-.518-1.184-.837-1.942-.837-2.812 0-3.733 3.829-1.158 5.138-.091.405-.132.837-.132 1.268 0 4.301 4.775 7.786 10.638 7.786 5.888 0 10.663-3.485 10.663-7.786 0-.431-.045-.883-.156-1.289 2.523-1.314 1.594-5.115-1.203-5.117zm-15.724 5.41c0-1.129.89-2.038 2.008-2.038 1.092 0 1.983.903 1.983 2.038 0 1.109-.89 2.013-1.983 2.013-1.113.005-2.008-.904-2.008-2.013zm10.839 4.798c-1.841 1.868-7.036 1.868-8.878 0-.203-.18-.203-.498 0-.703.177-.18.491-.18.668 0 1.406 1.463 6.07 1.488 7.537 0 .177-.18.491-.18.668 0 .207.206.207.524.005.703zm-.041-2.781c-1.092 0-1.982-.903-1.982-2.011 0-1.129.89-2.038 1.982-2.038 1.113 0 2.008.903 2.008 2.038-.005 1.103-.895 2.011-2.008 2.011z"></path>
            </svg>
        </div>

        <div class="mail" title="Share this through Email" onclick="window.open('mailto:?&amp;body=https://interrupt.memfault.com/blog/cortex-m-fault-debug');">
            <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
                <path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"></path>
            </svg>
        </div>
    </div>
</div>
        </aside>
      </div>

        <!-- Pagination links -->
        
    </div>

        <!-- Footer -->
        <footer class="footer">
  <div class="footer-links">
    <a href="https://interrupt.memfault.com/blog/feed.xml">
      <svg class="svg-icon orange"><use xlink:href="/blog/img/social-icons.svg#rss"></use></svg><span>RSS</span>
    </a>&nbsp;&nbsp;&nbsp;&nbsp;
    <a href="https://interrupt-slack.herokuapp.com/" target="_blank">
      <svg class="svg-icon slack"><use xlink:href="/blog/img/social-icons.svg#slack"></use></svg><span>Slack</span>
    </a>&nbsp;&nbsp;&nbsp;&nbsp;
    <a href="https://go.memfault.com/interrupt-subscribe" target="_blank">Subscribe</a>&nbsp;&nbsp;&nbsp;&nbsp;
    <a href="https://interrupt.memfault.com/blog/contributing">Contribute</a>&nbsp;&nbsp;&nbsp;&nbsp;
    <a href="https://community.memfault.com/" target="_blank">Community</a>&nbsp;&nbsp;&nbsp;&nbsp;
    <a href="https://memfault.com/" target="_blank">Memfault.com</a>&nbsp;&nbsp;&nbsp;&nbsp;
  </div>
  <div>© 2020 - Memfault, Inc.</div>
</footer>


        <!-- Script -->
        <script src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/main.js"></script>

<!-- Start of HubSpot Embed Code -->
<script type="text/javascript" id="hs-script-loader" async="" defer="defer" src="How%20to%20debug%20a%20HardFault%20on%20an%20ARM%20Cortex-M%20MCU%20Interrupt_files/8551838_002.js"></script>
<!-- End of HubSpot Embed Code -->


  </div>


<iframe style="display: none; visibility: hidden;" owner="archetype" title="archetype"></iframe></body></html>